<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Connor Robertson">

<title>Workshop 3: Data-driven discovery via Sparse Identification of Nonlinear Dynamics (SINDy) with neural network approximation and differentiation – Connor Robertson</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<link href="../../../../assets/circle-svgrepo-com.svg" rel="icon" type="image/svg+xml">
<script src="../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../../index.html">
    <span class="navbar-title">Connor Robertson</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../resume.html"> 
<span class="menu-text">Resume</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../research/research.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../other/fun/fun.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-other" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Other</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-other">    
        <li>
    <a class="dropdown-item" href="../../../../other/mlseminar/mlseminar.html">
 <span class="dropdown-text">Machine Learning and Optimization Seminar</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../other/teaching/teaching.html">
 <span class="dropdown-text">Teaching (NJIT)</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#sparse-identification-of-nonlinear-dynamics" id="toc-sparse-identification-of-nonlinear-dynamics" class="nav-link" data-scroll-target="#sparse-identification-of-nonlinear-dynamics">Sparse Identification of Nonlinear Dynamics</a>
  <ul class="collapse">
  <li><a href="#setting-up-linear-problem" id="toc-setting-up-linear-problem" class="nav-link" data-scroll-target="#setting-up-linear-problem">Setting up linear problem</a></li>
  <li><a href="#determining-nonlinear-library-of-terms" id="toc-determining-nonlinear-library-of-terms" class="nav-link" data-scroll-target="#determining-nonlinear-library-of-terms">Determining nonlinear “library” of terms</a></li>
  <li><a href="#numerical-differentiation-of-the-terms" id="toc-numerical-differentiation-of-the-terms" class="nav-link" data-scroll-target="#numerical-differentiation-of-the-terms">Numerical differentiation of the terms</a></li>
  <li><a href="#sparse-regression" id="toc-sparse-regression" class="nav-link" data-scroll-target="#sparse-regression">Sparse regression</a></li>
  <li><a href="#summary-of-the-method" id="toc-summary-of-the-method" class="nav-link" data-scroll-target="#summary-of-the-method">Summary of the method</a></li>
  </ul></li>
  <li><a href="#sec-simulated" id="toc-sec-simulated" class="nav-link" data-scroll-target="#sec-simulated">Application to simulated wave data</a>
  <ul class="collapse">
  <li><a href="#generating-nonlinear-library" id="toc-generating-nonlinear-library" class="nav-link" data-scroll-target="#generating-nonlinear-library">Generating nonlinear library</a></li>
  <li><a href="#approximating-data" id="toc-approximating-data" class="nav-link" data-scroll-target="#approximating-data">Approximating data</a></li>
  <li><a href="#numerically-differentiating-the-neural-network-model" id="toc-numerically-differentiating-the-neural-network-model" class="nav-link" data-scroll-target="#numerically-differentiating-the-neural-network-model">Numerically differentiating the neural network model</a></li>
  <li><a href="#solving-the-sparse-regression-problem" id="toc-solving-the-sparse-regression-problem" class="nav-link" data-scroll-target="#solving-the-sparse-regression-problem">Solving the sparse regression problem</a></li>
  </ul></li>
  <li><a href="#sec-noisy" id="toc-sec-noisy" class="nav-link" data-scroll-target="#sec-noisy">Application to noisy simulated wave data</a></li>
  <li><a href="#sec-extracted" id="toc-sec-extracted" class="nav-link" data-scroll-target="#sec-extracted">Application to extracted wave data</a>
  <ul class="collapse">
  <li><a href="#image-data-extraction" id="toc-image-data-extraction" class="nav-link" data-scroll-target="#image-data-extraction">Image data extraction</a></li>
  <li><a href="#using-our-experimental-dataset" id="toc-using-our-experimental-dataset" class="nav-link" data-scroll-target="#using-our-experimental-dataset">Using our experimental dataset</a></li>
  </ul></li>
  
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="workshop3_discovery.ipynb" download="workshop3_discovery.ipynb"><i class="bi bi-journal-code"></i>Jupyter</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Workshop 3: Data-driven discovery via Sparse Identification of Nonlinear Dynamics (SINDy) with neural network approximation and differentiation</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Connor Robertson </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>One common hallmark of popular machine learning methods is their “black-box” nature. Since many of these methods are meant solely for prediction, this has not been too much of an issue. After all, a black box method can be as complex as needed since it does not need to be analyzed after the fact. This mentality has given birth to increasingly complex but effective models (just take a look at <a href="https://nikcheerla.github.io/deeplearningschool//media/alphago_arch.png">the model</a> that defeated the worlds best Go player).</p>
<p>However, there has been some recent interest in models that can be understood and analyzed. This is particularly true in the scientific realm, where practicioners looking to use machine learning would like to get an idea of the mechanisms underlying their system of study. In order to do so, new tools have been created and old, interpretable tools, such as linear regression, have been adapted to meet this challenge.</p>
<p>Many of these new, interpretable, models have been named “data-driven model discovery.” Their goals is to model collected data from a system with machine learning tools to determine a human-readable model.</p>
</section>
<section id="sparse-identification-of-nonlinear-dynamics" class="level2">
<h2 class="anchored" data-anchor-id="sparse-identification-of-nonlinear-dynamics">Sparse Identification of Nonlinear Dynamics</h2>
<p>One method for model discovery as described above is called Sparse Identification of Nonlinear Dynamics (SINDy)<span class="citation" data-cites="brunton2016discovering">&nbsp;[<a href="#ref-brunton2016discovering" role="doc-biblioref">1</a>]</span>. The goal of this method is to extract the most probable differential equation directly from data of the important state variables of a continuum system.</p>
<section id="setting-up-linear-problem" class="level3">
<h3 class="anchored" data-anchor-id="setting-up-linear-problem">Setting up linear problem</h3>
<p>As its name suggests, this method works discover models for linear or nonlinear systems. It is based on a simple idea that nonlinear differential equations can be expressed as a linear combination of nonlinear terms<span class="citation" data-cites="williams2015data">&nbsp;[<a href="#ref-williams2015data" role="doc-biblioref">2</a>]</span>. Assuming we are looking at the nonlinear time evolution of some quantity, this could then be written as the sum of <span class="math inline">\(K\)</span> nonlinear terms: <span class="math display">\[
u_t(x,t) = \xi_1\mathcal{N}_1(u,x,t) + \ldots + \xi_K\mathcal{N}_K(u,x,t)
\]</span> If we can then determine what nonlinear terms are possible <span class="math inline">\(\mathcal{N}_i(u,x,t)\)</span>, we can sift through these terms to determine which best contribute to the time evolution of the system.</p>
<p>Ultimately, this boils down to a regression problem. Given some space and time samples of our state variable: <span class="math inline">\(u(x_i,t_j)\)</span> for <span class="math inline">\(i \leq N\)</span> and <span class="math inline">\(j \leq M\)</span>, we can consider the linear system: <span class="math display">\[
u_t(x_i,t_j) = \xi_1\mathcal{N}_1(u_{ij},x_i,t_j) + \ldots + \xi_K\mathcal{N}_K(u_{ij},x_i,t_j)
\]</span> Expanded for all the data samples (flattened across space and time), this can be written as the system: <span id="eq-linear-system"><span class="math display">\[
\begin{bmatrix}
u_t(x_1, t_1) \\
\vdots \\
u_t(x_N, t_1) \\
\vdots \\
u_t(x_N, t_M) \\
\end{bmatrix}
=
\begin{bmatrix}
\mathcal{N}_1(x_1, t_1) &amp; \ldots &amp; \mathcal{N}_K(x_1, t_1) \\
\vdots &amp;  &amp; \vdots \\
\mathcal{N}_1(x_N, t_1) &amp; \ldots &amp; \mathcal{N}_K(x_1, t_1) \\
\vdots &amp;  &amp; \vdots \\
\mathcal{N}_1(x_N, t_M) &amp; \ldots &amp; \mathcal{N}_K(x_1, t_1)
\end{bmatrix}
\vec{\xi}
\tag{1}\]</span></span></p>
<p>Solving this system is then a straightforward linear regression.</p>
</section>
<section id="determining-nonlinear-library-of-terms" class="level3">
<h3 class="anchored" data-anchor-id="determining-nonlinear-library-of-terms">Determining nonlinear “library” of terms</h3>
<p>Determining what <span class="math inline">\(\mathcal{N}_i(u,x,t)\)</span> are reasonable for the system is somewhat of a traditional modeling problem. Are there any symmetries in the system that need to be satisfied? Is there periodic behavior that might warrant inclusion of trignometric terms? What order of polynomial interactions are possible for the system?</p>
<p>The most common library of terms for a 1D function is to put together polynomial interactions with spatial derivatives. Such a library up to 3rd order polynomials and derivatives could be written: <span class="math display">\[
\begin{align*}
\mathcal{N}_1(u,x,t) &amp;= u\\
\mathcal{N}_2(u,x,t) &amp;= u^2\\
&amp;\vdots \\
\mathcal{N}_i(u,x,t) &amp;= u_x\\
\mathcal{N}_{i+1}(u,x,t) &amp;= u_x^2\\
&amp;\vdots \\
\mathcal{N}_K(u,x,t) &amp;= u^3u_{xxx}\\
\end{align*}
\]</span></p>
</section>
<section id="numerical-differentiation-of-the-terms" class="level3">
<h3 class="anchored" data-anchor-id="numerical-differentiation-of-the-terms">Numerical differentiation of the terms</h3>
<p>In order to actually compute the values in the linear system written in <a href="#eq-linear-system" class="quarto-xref">Equation&nbsp;1</a>, we must compute numerical derivatives in both <span class="math inline">\(t\)</span> and in <span class="math inline">\(x\)</span>. This isn’t an issue if we have smooth, reliable data and can be quickly computed with finite differences.</p>
<p>However, the intent of this method is to use data samples <span class="math inline">\(u(x_i,t_j)\)</span> that are collected from the real world, implying that they will each be polluted with some level of noise. There have been several classical methods presented for dealing with numerical differentiation of noisy data that could be used, but generally the methods revolve around an approximate fitting of a differentiable function basis to the data. Notable among these are:</p>
<ul>
<li>Local polynomial regression (LOESS<span class="citation" data-cites="cleveland1988locally">&nbsp;[<a href="#ref-cleveland1988locally" role="doc-biblioref">3</a>]</span>, Savitsky-Golay filter<span class="citation" data-cites="press1990savitzky">&nbsp;[<a href="#ref-press1990savitzky" role="doc-biblioref">4</a>]</span>, etc.)</li>
<li>Radial basis functions (Gaussian kernel)</li>
<li>Smoothing splines</li>
<li>Least squares spectral analysis (LSSA)</li>
</ul>
<p>These can be written along the lines of: <span class="math display">\[
\underset{\vec{c}}{\text{argmin}} \; \sum_{i,j}^{N,M}\|u(x_i,t_j) - F(x_i,t_j,\vec{c})\|_2
\]</span> where <span class="math display">\[
F(x_i,t_j,\vec{c}) = \sum_l^L c_l \phi_l(x_i,t_j)
\]</span> and <span class="math inline">\(\phi\)</span> represents our chosen basis function. Once computed, we can easily approximate derivatives of <span class="math inline">\(u\)</span> via: <span class="math display">\[
u_x(x_i,t_j) \approx F_x(x_i,t_j,\vec{c}) = \sum_l^L c_l \frac{d}{dx}\phi_l(x_i,t_j)
\]</span></p>
<p>Each of these has the goal of smoothing the given data while simultaneously providing an exact derivative of the approximation. This is a similar idea as we have discussed with automatic differentiation of neural networks. In fact, you could consider fitting a neural network to be the same as fitting a randomly initialized nested basis of nonlinear functions (since they are dense according to the universal approximation theorem). We will explore this idea in the example problem in <a href="#sec-simulated" class="quarto-xref">Section&nbsp;3</a>.</p>
</section>
<section id="sparse-regression" class="level3">
<h3 class="anchored" data-anchor-id="sparse-regression">Sparse regression</h3>
<p>Once the matrix in <a href="#eq-linear-system" class="quarto-xref">Equation&nbsp;1</a> has been created using numerical differentiation, it remains to sift through the nonlinear terms to determine which, if any, contribute to the time evolution of our state variable of interest. It is usually reasonable to consider that not all the nonlinear terms should be included in the equation, so we would like to determine the most parsimonious (smallest) combination of them that will capture our desired qualitative and quantitative behavior in the system.</p>
<p>There are two main families of sparse regression methods:</p>
<p><strong>Greedy methods</strong>: Iterative add/remove terms that best match the time derivative in some metric (<span class="math inline">\(R^2\)</span> coefficient of determination, Akaike Information Criteria (AIC), etc.).</p>
<ul>
<li>Forward selection: Start with no terms, add one by one according to which maximizes <span class="math inline">\(R^2\)</span> or AIC at each step</li>
<li>Backward selection: Start with all terms, remove one by one according to which least reduces <span class="math inline">\(R^2\)</span> or AIC</li>
<li>(Orthogonal) Matching pursuit: Start with no terms, add one by one according to which maximizes correlation (orthogonalizing after each step)</li>
</ul>
<p><strong>Regularization methods</strong>: Add a penalty to the regression for having too many terms or large coefficients <span class="math inline">\(\xi_i\)</span>. These can be written roughly as: <span class="math display">\[
\underset{\vec{\xi}}{\text{argmin}}\; \|u_t(x_i,t_j) - \mathbf{\mathcal{N}}(u_{ij},x_i,t_j) \cdot \vec{\xi}\|_2^2 + \lambda \|\xi\|_C
\]</span></p>
<ul>
<li>Ridge regression: Let <span class="math inline">\(C=2\)</span> forcing coefficients <span class="math inline">\(\vec{\xi}\)</span> to be smaller. We hope that important coefficients will remain larger while unimportant ones shrink.</li>
<li>Lasso regression: Let <span class="math inline">\(C=1\)</span> forcing coefficients <span class="math inline">\(\vec{\xi}\)</span> to be smaller and various to be set to 0 (due to the geometry of the 1-norm).</li>
<li>0-norm regression: Let <span class="math inline">\(C=0\)</span> which is a measure that counts the number of nonzero coefficients in <span class="math inline">\(\vec{\xi}\)</span>. Computing this usually requires a combination of regularization and relaxation best captured by the SR3 method<span class="citation" data-cites="zheng2018unified">&nbsp;[<a href="#ref-zheng2018unified" role="doc-biblioref">5</a>]</span>.</li>
</ul>
<p>Combinations of these two methods which iterative perform regularization methods removing terms with small coefficients according to a given threshold have also been proposed (Sequential Threshold Ridge Regression<span class="citation" data-cites="rudy2017data">&nbsp;[<a href="#ref-rudy2017data" role="doc-biblioref">6</a>]</span> or the original SINDy algorithm<span class="citation" data-cites="brunton2016discovering">&nbsp;[<a href="#ref-brunton2016discovering" role="doc-biblioref">1</a>]</span>).</p>
</section>
<section id="summary-of-the-method" class="level3">
<h3 class="anchored" data-anchor-id="summary-of-the-method">Summary of the method</h3>
<p>In summary, the procedure to use SINDy is as follows:</p>
<ol type="1">
<li>Collect sample points of a continuum state variable of interest <span class="math inline">\(u(x_i,t_j)\)</span></li>
<li>Form a “library” of possible terms for the differential model of the system <span class="math inline">\(\mathcal{N}_k(u,x,t)\)</span></li>
<li>Compute the libary at sample points using noise robust numerical differentiation to compute both <span class="math inline">\(u_t(x_i,t_j)\)</span> and <span class="math inline">\(\mathcal{N}_k(u_{ij},x_i,t_j)\)</span></li>
<li>Use sparse regression to determine a sparse vector <span class="math inline">\(\vec{\xi}\)</span> which closely approximates <span class="math inline">\(u_t(x_i,t_j) = \xi_1\mathcal{N}_1(u_{ij},x_i,t_j) + \ldots + \xi_K\mathcal{N}_K(u_{ij},x_i,t_j)\)</span></li>
</ol>
<p>To really explore this method, we will walk through this process using simulated traveling wave data in <a href="#sec-simulated" class="quarto-xref">Section&nbsp;3</a> and using real extracted data in <a href="#sec-extracted" class="quarto-xref">Section&nbsp;5</a>.</p>
</section>
</section>
<section id="sec-simulated" class="level2">
<h2 class="anchored" data-anchor-id="sec-simulated">Application to simulated wave data</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>For this workshop you will need to install the following packages:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">mamba</span> install numpy matplotlib py-pde sympy jax optax flax scikit-learn scikit-image av</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Given some data generated via finite differences of the simple advection equation: <span class="math display">\[
h_t(x,t) = h_x(x,t)
\]</span> with periodic boundaries and a Gaussian initial condition, we have the following measurement of state variable <span class="math inline">\(h\)</span> (height of the wave):</p>
<div class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Generate simple wave data</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pde</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Domain</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>xmax <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>nx <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> <span class="fl">1e-6</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>tmax <span class="op">=</span> <span class="fl">1.0</span><span class="op">-</span><span class="dv">2</span><span class="op">*</span>dt</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>save_dt <span class="op">=</span> <span class="fl">0.01</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>init_cond <span class="op">=</span> <span class="st">".1*exp(-(1/.01)*(x-0.3)**2)"</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> pde.CartesianGrid([(<span class="fl">0.0</span>,xmax)],nx,periodic<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>h <span class="op">=</span> pde.ScalarField.from_expression(grid,init_cond,label<span class="op">=</span><span class="st">"h(x,t)"</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>eq <span class="op">=</span> pde.PDE({<span class="st">"h"</span>: <span class="st">"-d_dx(h)"</span>})</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>storage <span class="op">=</span> pde.MemoryStorage()</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> eq.solve(h,t_range<span class="op">=</span>tmax,dt<span class="op">=</span>dt,tracker<span class="op">=</span>storage.tracker(save_dt),ret_info<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co"># pde.plot_kymograph(storage)</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>movie <span class="op">=</span> pde.visualization.movie(storage,<span class="st">"simple_wave.gif"</span>)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>h<span class="op">=</span>np.array(storage.data)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>x<span class="op">=</span>storage.grid.coordinate_arrays[<span class="dv">0</span>]</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>t<span class="op">=</span>np.array(storage.times)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>np.savez(<span class="st">"simple_wave.npz"</span>,h<span class="op">=</span>h,x<span class="op">=</span>x,t<span class="op">=</span>t)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>plt.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"2dd9113033de41459648e8369ede3f82","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<p><img src="simple_wave.gif" class="img-fluid"></p>
<section id="generating-nonlinear-library" class="level3">
<h3 class="anchored" data-anchor-id="generating-nonlinear-library">Generating nonlinear library</h3>
<p>Generating a library can be most easily accomplished using the <code>sympy</code> symbolic math Python library. To be overly thorough, we will generate up to 4th order polynomial combinations of up to 4th order spatial derivatives.</p>
<p>We can first initialize our spatial and state variables:</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sympy <span class="im">as</span> sp</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>x_sym,t_sym <span class="op">=</span> sp.symbols(<span class="st">"x t"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>h_sym <span class="op">=</span> sp.Function(<span class="st">"h"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Given a specified order, we can now create symbolic derivative terms (constructed to be most legible):</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Library parameters</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>max_poly_order <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>max_diff_order <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>diff_terms <span class="op">=</span> [h_sym(x_sym,t_sym)]</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>diff_terms <span class="op">+=</span> [sp.Function(<span class="bu">str</span>(h_sym)<span class="op">+</span><span class="st">"_"</span><span class="op">+</span>(i<span class="op">*</span><span class="bu">str</span>(x_sym)))(x_sym,t_sym) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,max_diff_order<span class="op">+</span><span class="dv">1</span>)]</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(diff_terms)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[h(x, t), h_x(x, t), h_xx(x, t), h_xxx(x, t), h_xxxx(x, t)]</code></pre>
</div>
</div>
<p>Now, combining these into polynomials up to 4th order (again, this is overkill, but for a system you don’t fully understand, you may want to have a very complete library):</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> combinations_with_replacement</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>terms <span class="op">=</span> []</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> po <span class="kw">in</span> <span class="bu">range</span>(max_poly_order<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> po <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        term <span class="op">=</span> sp.core.numbers.One()</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        combos <span class="op">=</span> combinations_with_replacement(diff_terms,po)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> combo <span class="kw">in</span> combos:</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>            term <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> combo_term <span class="kw">in</span> combo:</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>                term <span class="op">*=</span> combo_term</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>            terms.append(term)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(terms)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[h(x, t), h_x(x, t), h_xx(x, t), h_xxx(x, t), h_xxxx(x, t), h(x, t)**2, h(x, t)*h_x(x, t), h(x, t)*h_xx(x, t), h(x, t)*h_xxx(x, t), h(x, t)*h_xxxx(x, t), h_x(x, t)**2, h_x(x, t)*h_xx(x, t), h_x(x, t)*h_xxx(x, t), h_x(x, t)*h_xxxx(x, t), h_xx(x, t)**2, h_xx(x, t)*h_xxx(x, t), h_xx(x, t)*h_xxxx(x, t), h_xxx(x, t)**2, h_xxx(x, t)*h_xxxx(x, t), h_xxxx(x, t)**2, h(x, t)**3, h(x, t)**2*h_x(x, t), h(x, t)**2*h_xx(x, t), h(x, t)**2*h_xxx(x, t), h(x, t)**2*h_xxxx(x, t), h(x, t)*h_x(x, t)**2, h(x, t)*h_x(x, t)*h_xx(x, t), h(x, t)*h_x(x, t)*h_xxx(x, t), h(x, t)*h_x(x, t)*h_xxxx(x, t), h(x, t)*h_xx(x, t)**2, h(x, t)*h_xx(x, t)*h_xxx(x, t), h(x, t)*h_xx(x, t)*h_xxxx(x, t), h(x, t)*h_xxx(x, t)**2, h(x, t)*h_xxx(x, t)*h_xxxx(x, t), h(x, t)*h_xxxx(x, t)**2, h_x(x, t)**3, h_x(x, t)**2*h_xx(x, t), h_x(x, t)**2*h_xxx(x, t), h_x(x, t)**2*h_xxxx(x, t), h_x(x, t)*h_xx(x, t)**2, h_x(x, t)*h_xx(x, t)*h_xxx(x, t), h_x(x, t)*h_xx(x, t)*h_xxxx(x, t), h_x(x, t)*h_xxx(x, t)**2, h_x(x, t)*h_xxx(x, t)*h_xxxx(x, t), h_x(x, t)*h_xxxx(x, t)**2, h_xx(x, t)**3, h_xx(x, t)**2*h_xxx(x, t), h_xx(x, t)**2*h_xxxx(x, t), h_xx(x, t)*h_xxx(x, t)**2, h_xx(x, t)*h_xxx(x, t)*h_xxxx(x, t), h_xx(x, t)*h_xxxx(x, t)**2, h_xxx(x, t)**3, h_xxx(x, t)**2*h_xxxx(x, t), h_xxx(x, t)*h_xxxx(x, t)**2, h_xxxx(x, t)**3, h(x, t)**4, h(x, t)**3*h_x(x, t), h(x, t)**3*h_xx(x, t), h(x, t)**3*h_xxx(x, t), h(x, t)**3*h_xxxx(x, t), h(x, t)**2*h_x(x, t)**2, h(x, t)**2*h_x(x, t)*h_xx(x, t), h(x, t)**2*h_x(x, t)*h_xxx(x, t), h(x, t)**2*h_x(x, t)*h_xxxx(x, t), h(x, t)**2*h_xx(x, t)**2, h(x, t)**2*h_xx(x, t)*h_xxx(x, t), h(x, t)**2*h_xx(x, t)*h_xxxx(x, t), h(x, t)**2*h_xxx(x, t)**2, h(x, t)**2*h_xxx(x, t)*h_xxxx(x, t), h(x, t)**2*h_xxxx(x, t)**2, h(x, t)*h_x(x, t)**3, h(x, t)*h_x(x, t)**2*h_xx(x, t), h(x, t)*h_x(x, t)**2*h_xxx(x, t), h(x, t)*h_x(x, t)**2*h_xxxx(x, t), h(x, t)*h_x(x, t)*h_xx(x, t)**2, h(x, t)*h_x(x, t)*h_xx(x, t)*h_xxx(x, t), h(x, t)*h_x(x, t)*h_xx(x, t)*h_xxxx(x, t), h(x, t)*h_x(x, t)*h_xxx(x, t)**2, h(x, t)*h_x(x, t)*h_xxx(x, t)*h_xxxx(x, t), h(x, t)*h_x(x, t)*h_xxxx(x, t)**2, h(x, t)*h_xx(x, t)**3, h(x, t)*h_xx(x, t)**2*h_xxx(x, t), h(x, t)*h_xx(x, t)**2*h_xxxx(x, t), h(x, t)*h_xx(x, t)*h_xxx(x, t)**2, h(x, t)*h_xx(x, t)*h_xxx(x, t)*h_xxxx(x, t), h(x, t)*h_xx(x, t)*h_xxxx(x, t)**2, h(x, t)*h_xxx(x, t)**3, h(x, t)*h_xxx(x, t)**2*h_xxxx(x, t), h(x, t)*h_xxx(x, t)*h_xxxx(x, t)**2, h(x, t)*h_xxxx(x, t)**3, h_x(x, t)**4, h_x(x, t)**3*h_xx(x, t), h_x(x, t)**3*h_xxx(x, t), h_x(x, t)**3*h_xxxx(x, t), h_x(x, t)**2*h_xx(x, t)**2, h_x(x, t)**2*h_xx(x, t)*h_xxx(x, t), h_x(x, t)**2*h_xx(x, t)*h_xxxx(x, t), h_x(x, t)**2*h_xxx(x, t)**2, h_x(x, t)**2*h_xxx(x, t)*h_xxxx(x, t), h_x(x, t)**2*h_xxxx(x, t)**2, h_x(x, t)*h_xx(x, t)**3, h_x(x, t)*h_xx(x, t)**2*h_xxx(x, t), h_x(x, t)*h_xx(x, t)**2*h_xxxx(x, t), h_x(x, t)*h_xx(x, t)*h_xxx(x, t)**2, h_x(x, t)*h_xx(x, t)*h_xxx(x, t)*h_xxxx(x, t), h_x(x, t)*h_xx(x, t)*h_xxxx(x, t)**2, h_x(x, t)*h_xxx(x, t)**3, h_x(x, t)*h_xxx(x, t)**2*h_xxxx(x, t), h_x(x, t)*h_xxx(x, t)*h_xxxx(x, t)**2, h_x(x, t)*h_xxxx(x, t)**3, h_xx(x, t)**4, h_xx(x, t)**3*h_xxx(x, t), h_xx(x, t)**3*h_xxxx(x, t), h_xx(x, t)**2*h_xxx(x, t)**2, h_xx(x, t)**2*h_xxx(x, t)*h_xxxx(x, t), h_xx(x, t)**2*h_xxxx(x, t)**2, h_xx(x, t)*h_xxx(x, t)**3, h_xx(x, t)*h_xxx(x, t)**2*h_xxxx(x, t), h_xx(x, t)*h_xxx(x, t)*h_xxxx(x, t)**2, h_xx(x, t)*h_xxxx(x, t)**3, h_xxx(x, t)**4, h_xxx(x, t)**3*h_xxxx(x, t), h_xxx(x, t)**2*h_xxxx(x, t)**2, h_xxx(x, t)*h_xxxx(x, t)**3, h_xxxx(x, t)**4]</code></pre>
</div>
</div>
</section>
<section id="approximating-data" class="level3">
<h3 class="anchored" data-anchor-id="approximating-data">Approximating data</h3>
<p>In order to provide numerical derivatives of our data, we will use a neural network approximation.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is far beyond what is necessary for this particular setting, but is a method that can generalize to data not on a uniform grid and in high dimension, which can be useful. The lack of requirement for a grid can also help with robustly fitting to noisy data by using a train-test methodology in <a href="#sec-noisy" class="quarto-xref">Section&nbsp;4</a> which classical basis functions do not handle well. Using neural networks in this way as a combination with SINDy is explored more in<span class="citation" data-cites="xu2019dl">&nbsp;[<a href="#ref-xu2019dl" role="doc-biblioref">7</a>]</span>.</p>
</div>
</div>
<p>To begin, we will be using the Google developed <a href="https://flax.readthedocs.io/en/latest/"><code>flax</code></a> neural network framework which is built on their <a href="https://jax.readthedocs.io/en/latest/index.html"><code>jax</code></a> automatic differentiation library and the <a href="https://optax.readthedocs.io/en/latest/optax-101.html"><code>optax</code></a> optimization library. The reason for this will become clearer when we consider taking a fourth order derivative in <span class="math inline">\(x\)</span> of the network, a task which many other popular frameworks (<code>pytorch</code>, <code>keras</code>, <code>tensorflow</code>, etc.) cannot do (at least not nearly as concisely). However, the <code>jax</code> library is state-of-the-art for automatic differentiation and is used heavily for differentiable programming and neural network research today (see Appendix for more information).</p>
<section id="creating-the-neural-network-model" class="level4">
<h4 class="anchored" data-anchor-id="creating-the-neural-network-model">Creating the neural network model</h4>
<p>First, we will create a simple dense neural network model using the <span class="math inline">\(\tanh\)</span> activation (to ensure a smooth approximation):</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> flax.linen <span class="im">as</span> nn</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MyNet(nn.Module):</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">@nn.compact</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__call__</span>(<span class="va">self</span>, x):</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> nn.Dense(<span class="dv">60</span>)(x)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> nn.tanh(x)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> nn.Dense(<span class="dv">12</span>)(x)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> nn.tanh(x)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> nn.Dense(<span class="dv">1</span>)(x)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This model will take an input of <span class="math inline">\((x_i,t_j)\)</span> (a dimension 2 array), linearly map it to a dimension 60 space, apply a tanh activation, linearly map to a dimension 12 space, apply a tanh activation, then linearly map to a dimension 1 output (this particular width and depth was chosen arbitrarily).</p>
<p>We next initialize the parameters of the network (each of the linear transformation matrices) and print out the dimensions of the corresponding arrays:</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> jax</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>jax.config.update(<span class="st">"jax_platform_name"</span>, <span class="st">"cpu"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Random generator seed</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>rng1,rng2 <span class="op">=</span> jax.random.split(jax.random.PRNGKey(<span class="dv">42</span>))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>random_data <span class="op">=</span> jax.random.normal(rng1,(<span class="dv">2</span>,))</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>model1 <span class="op">=</span> MyNet()</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>params1 <span class="op">=</span> model1.init(rng2,random_data)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(jax.tree_util.tree_map(<span class="kw">lambda</span> x: x.shape, params1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>FrozenDict({
    params: {
        Dense_0: {
            bias: (60,),
            kernel: (2, 60),
        },
        Dense_1: {
            bias: (12,),
            kernel: (60, 12),
        },
        Dense_2: {
            bias: (1,),
            kernel: (12, 1),
        },
    },
})</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The confusing <code>tree_util.tree_map</code> command is a convenience function for mapping a function (in this case <code>lambda x: x.shape</code>) across a set of different objects. This is useful because these objects can be arrays, dictionaries, lists, classes (i.e.&nbsp;other neural networks), etc.</p>
</div>
</div>
</section>
<section id="loading-and-processing-data" class="level4">
<h4 class="anchored" data-anchor-id="loading-and-processing-data">Loading and processing data</h4>
<p>In order to fit this model to the data, we must load the data into batches of <span class="math inline">\((x_i,t_j,u(x_i,t_j))\)</span> points. Since our data is known to be quite smooth and we want to maximize the fit, we will use batches of size 10000:</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> jax.numpy <span class="im">as</span> jnp</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_data(data_path,noise_scale<span class="op">=</span><span class="dv">0</span>,norm<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    raw_data <span class="op">=</span> np.load(data_path)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    h <span class="op">=</span> raw_data[<span class="st">"h"</span>].astype(jnp.float32)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> raw_data[<span class="st">"x"</span>].astype(jnp.float32)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> raw_data[<span class="st">"t"</span>].astype(jnp.float32)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add noise if needed</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    h <span class="op">+=</span> noise_scale<span class="op">*</span>jnp.std(h)<span class="op">*</span>np.random.normal(size<span class="op">=</span>h.shape)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Mean center, std center data</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> norm:</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>        h <span class="op">=</span> (h <span class="op">-</span> jnp.mean(h)) <span class="op">/</span> jnp.std(h)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> (x <span class="op">-</span> jnp.mean(x)) <span class="op">/</span> jnp.std(x)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>        t <span class="op">=</span> (t <span class="op">-</span> jnp.mean(t)) <span class="op">/</span> jnp.std(t)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x,t,h</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> batch_data(x,t,h,batch_size):</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Split data into batches</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> []</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(x),batch_size):</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>        temp_xt <span class="op">=</span> jnp.vstack((x[i:i<span class="op">+</span>batch_size], t[i:i<span class="op">+</span>batch_size])).T</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>        temp_h <span class="op">=</span> h[i:i<span class="op">+</span>batch_size].reshape((<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>        data.append((temp_xt,temp_h))</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>x,t,h <span class="op">=</span> load_data(<span class="st">"simple_wave.npz"</span>)</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>X,T <span class="op">=</span> jnp.meshgrid(x,t)</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> batch_data(X.flatten(),T.flatten(),h.flatten(),<span class="dv">10000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that the data needed to be centered and scaled to have a mean of <span class="math inline">\(\bar{h}=0\)</span> and standard deviation of <span class="math inline">\(\overline{(h - \bar{h})}=1\)</span> in order to best use the <span class="math inline">\(\tanh\)</span> activation (which extends from -1 to 1).</p>
</section>
<section id="training-the-model" class="level4">
<h4 class="anchored" data-anchor-id="training-the-model">Training the model</h4>
<p>We will use the mean squared error fit of the data to our neural network output (just in time compiled with <code>@jax.jit</code> for maximum speed):</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="at">@jax.jit</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mse(params,<span class="bu">input</span>,targets):</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> squared_error(x,y):</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>        pred <span class="op">=</span> model1.<span class="bu">apply</span>(params,x)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jnp.mean((y <span class="op">-</span> pred)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> jnp.mean(jax.vmap(squared_error)(<span class="bu">input</span>,targets),axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>loss_grad_fn <span class="op">=</span> jax.value_and_grad(mse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With this loss defined, we initialize an ADAM optimizer and optimizer state and wrap the loss function to return both the output and gradient:</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> optax</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>learning_rate <span class="op">=</span> <span class="fl">1e-2</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>tx <span class="op">=</span> optax.adam(learning_rate)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>opt_state <span class="op">=</span> tx.init(params1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now train the model to take in <span class="math inline">\((x_i,t_j)\)</span> and output <span class="math inline">\(u(x_i,t_j)\)</span>. Performing 1000 iterations over the data, we will print the mean squared error on the data as we proceed with the training:</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>epochs <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>all_xt <span class="op">=</span> jnp.array([data[i][<span class="dv">0</span>] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data))])</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>all_h <span class="op">=</span> jnp.array([data[i][<span class="dv">1</span>] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data))])</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(epochs):</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    xt_batch <span class="op">=</span> data[i<span class="op">%</span><span class="bu">len</span>(data)][<span class="dv">0</span>]</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    h_batch <span class="op">=</span> data[i<span class="op">%</span><span class="bu">len</span>(data)][<span class="dv">1</span>]</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    loss_val, grads <span class="op">=</span> loss_grad_fn(params1, xt_batch, h_batch)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    updates, opt_state <span class="op">=</span> tx.update(grads, opt_state)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    params1 <span class="op">=</span> optax.apply_updates(params1, updates)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">%</span> <span class="dv">100</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>        train_loss <span class="op">=</span> mse(params1,all_xt,all_h)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Training loss step </span><span class="sc">{}</span><span class="st">: </span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(i,train_loss))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Training loss step 0: 1.089915156364441
Training loss step 100: 0.16426406800746918
Training loss step 200: 0.09340785443782806
Training loss step 300: 0.01907801441848278
Training loss step 400: 0.0014767495449632406
Training loss step 500: 0.000554197293240577
Training loss step 600: 0.00032399679184891284
Training loss step 700: 0.00021209089027252048
Training loss step 800: 0.0001550953311379999
Training loss step 900: 0.0001249150518560782</code></pre>
</div>
</div>
<p>As you can tell, this procedure is somewhat more manual than other libraries such as <code>keras</code> but keep you closer to the details, allowing for more flexibility in implementation.</p>
</section>
<section id="validating-fit" class="level4">
<h4 class="anchored" data-anchor-id="validating-fit">Validating fit</h4>
<p>The fit to the model can be visualized as follows:</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.animation <span class="im">as</span> anim</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>X,T <span class="op">=</span> jnp.meshgrid(x,t)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>xt_points <span class="op">=</span> jnp.vstack([X.flatten(),T.flatten()]).T</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>hhat1 <span class="op">=</span> model1.<span class="bu">apply</span>(params1,xt_points).reshape(X.shape)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>diff <span class="op">=</span> np.sqrt((h <span class="op">-</span> hhat1)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> animate_data(x,t,data_list,labels):</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> plt.figure()</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"$x$"</span>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    plots <span class="op">=</span> []</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data_list)):</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>        plot <span class="op">=</span> plt.plot(x,data_list[i][<span class="dv">0</span>,:],label<span class="op">=</span>labels[i])[<span class="dv">0</span>]</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>        plots.append(plot)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> anim_func(j):</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(plots)):</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>            plots[i].set_ydata(data_list[i][j,:])</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> plots</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    approx_anim <span class="op">=</span> anim.FuncAnimation(fig, anim_func, <span class="bu">range</span>(<span class="bu">len</span>(t)))</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> approx_anim</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>animation1 <span class="op">=</span> animate_data(x,t,[h,hhat1,diff],[<span class="st">"$h$"</span>,<span class="st">"$\hat</span><span class="sc">{h}</span><span class="st">$"</span>,<span class="st">"$L^2$ error"</span>])</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>animation1.save(<span class="st">"clean_h_compare.gif"</span>)</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>plt.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="clean_h_compare.gif" class="img-fluid"></p>
</section>
</section>
<section id="numerically-differentiating-the-neural-network-model" class="level3">
<h3 class="anchored" data-anchor-id="numerically-differentiating-the-neural-network-model">Numerically differentiating the neural network model</h3>
<p>The original reason to fit this model to the data was to be able to construct each of the terms in our nonlinear libary for the system. In order to differentiate the model, we must wrap it in a function that takes our inputs and returns the output.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> model_for_diff(x,t):</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    new_x <span class="op">=</span> jnp.array([x,t])</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model1.<span class="bu">apply</span>(params1, new_x)[<span class="dv">0</span>]</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a derivative with respect to the first input (x) at point (x_i,t_j)</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>x_i <span class="op">=</span> <span class="fl">0.3</span><span class="op">;</span> t_j <span class="op">=</span> <span class="fl">0.3</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>jax.grad(model_for_diff,<span class="dv">0</span>)(x_i,t_j)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>Array(0.02786821, dtype=float32, weak_type=True)</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If we were to differentiate the model directly, we would compute derivatives for all the parameters! This is the main challenge with using other neural network frameworks for this kind of function approximation.</p>
</div>
</div>
<p>Applying this iteratively, we can construct derivatives <span class="math inline">\(h_x(x,t), \ldots, h_{xxxx}(x,t)\)</span> as is required by our library:</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>diff_term_values <span class="op">=</span> {}</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(max_diff_order<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    diff_func <span class="op">=</span> model_for_diff</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Iteratively apply derivatives</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(i):</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>        diff_func <span class="op">=</span> jax.grad(diff_func, <span class="dv">0</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> unpack_diff_func(x):</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>        new_x,new_t <span class="op">=</span> x</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> diff_func(new_x,new_t)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    diff_term_values[diff_terms[i]] <span class="op">=</span> np.array(jax.lax.<span class="bu">map</span>(unpack_diff_func, xt_points))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can then reconstruct our terms attaching them to their corresponding values on our <span class="math inline">\((x,t)\)</span> grid:</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> construct_terms(diff_term_values):</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    term_values <span class="op">=</span> {}</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    term_shape <span class="op">=</span> np.shape(diff_term_values[<span class="bu">list</span>(diff_term_values.keys())[<span class="dv">0</span>]])</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> order <span class="kw">in</span> <span class="bu">range</span>(max_poly_order<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> order <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>            term <span class="op">=</span> sp.core.numbers.One()</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>            term_values[term] <span class="op">=</span> np.ones(term_shape)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>            combos <span class="op">=</span> combinations_with_replacement(diff_terms,order)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> combo <span class="kw">in</span> combos:</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>                term <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>                temp_term_value <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> combo_term <span class="kw">in</span> combo:</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>                    term <span class="op">*=</span> combo_term</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>                    temp_term_value <span class="op">*=</span> diff_term_values[combo_term]</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>                term_values[term] <span class="op">=</span> temp_term_value</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> term_values</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>term_values <span class="op">=</span> construct_terms(diff_term_values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we compute the derivative of the network with respect to time:</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> unpack_diff_func(x):</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    new_x,new_t <span class="op">=</span> x</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> jax.grad(model_for_diff,<span class="dv">1</span>)(new_x,new_t)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>h_t_term <span class="op">=</span> sp.Function(<span class="st">"h_t"</span>)(x_sym,t_sym)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>h_t <span class="op">=</span> <span class="op">-</span>np.array(jax.lax.<span class="bu">map</span>(unpack_diff_func, xt_points))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="solving-the-sparse-regression-problem" class="level3">
<h3 class="anchored" data-anchor-id="solving-the-sparse-regression-problem">Solving the sparse regression problem</h3>
<p>In order to cleanly work with our term library, we will use a very popular Python data science package called <code>pandas</code>. Simply put, this library allows you to easily load, manipulate, and save tabular data. Here is our library as a <code>pandas</code> <code>DataFrame</code>:</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>term_matrix <span class="op">=</span> pd.DataFrame(term_values,index<span class="op">=</span>pd.MultiIndex.from_arrays(np.<span class="bu">round</span>(np.array(xt_points),<span class="dv">2</span>).T, names<span class="op">=</span>(<span class="st">"x"</span>,<span class="st">"t"</span>)))</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>term_matrix</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">h(x, t)</th>
<th data-quarto-table-cell-role="th">h_x(x, t)</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h(x, t)**2</th>
<th data-quarto-table-cell-role="th">h(x, t)*h_x(x, t)</th>
<th data-quarto-table-cell-role="th">h(x, t)*h_xx(x, t)</th>
<th data-quarto-table-cell-role="th">h(x, t)*h_xxx(x, t)</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)**2*h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxx(x, t)**3</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxx(x, t)**2*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxx(x, t)*h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxxx(x, t)**3</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)**4</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)**3*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)**2*h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)*h_xxxx(x, t)**3</th>
<th data-quarto-table-cell-role="th">h_xxxx(x, t)**4</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">x</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">-1.71</td>
<td data-quarto-table-cell-role="th">-1.71</td>
<td>1.0</td>
<td>-0.586198</td>
<td>0.034345</td>
<td>0.328429</td>
<td>3.294152</td>
<td>31.305639</td>
<td>0.343628</td>
<td>-0.020133</td>
<td>-0.192524</td>
<td>-1.931026</td>
<td>...</td>
<td>105.712776</td>
<td>11.740110</td>
<td>111.570938</td>
<td>1060.302979</td>
<td>1.007648e+04</td>
<td>117.753731</td>
<td>1119.060547</td>
<td>1.063488e+04</td>
<td>1.010675e+05</td>
<td>9.604844e+05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">-1.68</td>
<td data-quarto-table-cell-role="th">-1.71</td>
<td>1.0</td>
<td>-0.584787</td>
<td>0.047935</td>
<td>0.463436</td>
<td>4.565125</td>
<td>42.639248</td>
<td>0.341976</td>
<td>-0.028032</td>
<td>-0.271011</td>
<td>-2.669625</td>
<td>...</td>
<td>390.480194</td>
<td>44.090813</td>
<td>411.817627</td>
<td>3846.464600</td>
<td>3.592680e+04</td>
<td>434.321045</td>
<td>4056.651611</td>
<td>3.788999e+04</td>
<td>3.539006e+05</td>
<td>3.305508e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">-1.65</td>
<td data-quarto-table-cell-role="th">-1.71</td>
<td>1.0</td>
<td>-0.582814</td>
<td>0.067048</td>
<td>0.650005</td>
<td>6.293957</td>
<td>57.914425</td>
<td>0.339672</td>
<td>-0.039077</td>
<td>-0.378832</td>
<td>-3.668204</td>
<td>...</td>
<td>1417.120361</td>
<td>162.064529</td>
<td>1491.251587</td>
<td>13721.887695</td>
<td>1.262632e+05</td>
<td>1569.260986</td>
<td>14439.698242</td>
<td>1.328682e+05</td>
<td>1.222599e+06</td>
<td>1.124986e+07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">-1.61</td>
<td data-quarto-table-cell-role="th">-1.71</td>
<td>1.0</td>
<td>-0.580054</td>
<td>0.093777</td>
<td>0.906569</td>
<td>8.635473</td>
<td>78.191200</td>
<td>0.336462</td>
<td>-0.054395</td>
<td>-0.525858</td>
<td>-5.009038</td>
<td>...</td>
<td>5024.779785</td>
<td>583.793213</td>
<td>5286.043945</td>
<td>47863.289062</td>
<td>4.333854e+05</td>
<td>5560.893066</td>
<td>50351.949219</td>
<td>4.559194e+05</td>
<td>4.128191e+06</td>
<td>3.737933e+07</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">-1.58</td>
<td data-quarto-table-cell-role="th">-1.71</td>
<td>1.0</td>
<td>-0.576197</td>
<td>0.130949</td>
<td>1.257589</td>
<td>11.781665</td>
<td>104.532784</td>
<td>0.332003</td>
<td>-0.075453</td>
<td>-0.724619</td>
<td>-6.788559</td>
<td>...</td>
<td>17281.535156</td>
<td>2056.641846</td>
<td>18247.546875</td>
<td>161901.296875</td>
<td>1.436469e+06</td>
<td>19267.558594</td>
<td>170951.343750</td>
<td>1.516765e+06</td>
<td>1.345749e+07</td>
<td>1.194016e+08</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1.58</td>
<td data-quarto-table-cell-role="th">1.71</td>
<td>1.0</td>
<td>-0.595861</td>
<td>-0.032445</td>
<td>0.094316</td>
<td>0.828272</td>
<td>6.051974</td>
<td>0.355050</td>
<td>0.019333</td>
<td>-0.056199</td>
<td>-0.493535</td>
<td>...</td>
<td>0.325811</td>
<td>0.053593</td>
<td>0.391587</td>
<td>2.861229</td>
<td>2.090628e+01</td>
<td>0.470643</td>
<td>3.438868</td>
<td>2.512695e+01</td>
<td>1.835964e+02</td>
<td>1.341493e+03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1.61</td>
<td data-quarto-table-cell-role="th">1.71</td>
<td>1.0</td>
<td>-0.596922</td>
<td>-0.028636</td>
<td>0.127099</td>
<td>1.080399</td>
<td>8.665757</td>
<td>0.356316</td>
<td>0.017094</td>
<td>-0.075868</td>
<td>-0.644914</td>
<td>...</td>
<td>1.213107</td>
<td>0.160286</td>
<td>1.285635</td>
<td>10.311934</td>
<td>8.271088e+01</td>
<td>1.362498</td>
<td>10.928448</td>
<td>8.765587e+01</td>
<td>7.030781e+02</td>
<td>5.639311e+03</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1.65</td>
<td data-quarto-table-cell-role="th">1.71</td>
<td>1.0</td>
<td>-0.597831</td>
<td>-0.023519</td>
<td>0.170407</td>
<td>1.441151</td>
<td>12.374259</td>
<td>0.357401</td>
<td>0.014061</td>
<td>-0.101875</td>
<td>-0.861564</td>
<td>...</td>
<td>4.446455</td>
<td>0.510054</td>
<td>4.379515</td>
<td>37.604141</td>
<td>3.228831e+02</td>
<td>4.313581</td>
<td>37.038013</td>
<td>3.180222e+02</td>
<td>2.730656e+03</td>
<td>2.344643e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1.68</td>
<td data-quarto-table-cell-role="th">1.71</td>
<td>1.0</td>
<td>-0.598532</td>
<td>-0.016657</td>
<td>0.228717</td>
<td>1.955418</td>
<td>17.616632</td>
<td>0.358240</td>
<td>0.009970</td>
<td>-0.136894</td>
<td>-1.170380</td>
<td>...</td>
<td>16.234627</td>
<td>1.710083</td>
<td>15.406376</td>
<td>138.798172</td>
<td>1.250452e+03</td>
<td>14.620379</td>
<td>131.717010</td>
<td>1.186657e+03</td>
<td>1.069075e+04</td>
<td>9.631448e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1.71</td>
<td data-quarto-table-cell-role="th">1.71</td>
<td>1.0</td>
<td>-0.598957</td>
<td>-0.007424</td>
<td>0.308405</td>
<td>2.686601</td>
<td>25.003866</td>
<td>0.358750</td>
<td>0.004447</td>
<td>-0.184721</td>
<td>-1.609159</td>
<td>...</td>
<td>59.464287</td>
<td>5.980401</td>
<td>55.658863</td>
<td>518.010254</td>
<td>4.821059e+03</td>
<td>52.096973</td>
<td>484.860199</td>
<td>4.512535e+03</td>
<td>4.199762e+04</td>
<td>3.908667e+05</td>
</tr>
</tbody>
</table>

<p>10000 rows × 126 columns</p>
</div>
</div>
</div>
<p>We then use another extremely popular machine learning Python package called <code>scikit-learn</code> to easily work with our regression models.</p>
<section id="ordinary-least-squares" class="level4">
<h4 class="anchored" data-anchor-id="ordinary-least-squares">Ordinary least squares</h4>
<p>First, let’s apply ordinary least squares to see if the solution is clear:</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sklearn.linear_model <span class="im">as</span> lm</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sklearn.metrics <span class="im">as</span> met</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_ols_results(A,b):</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    ols <span class="op">=</span> lm.LinearRegression()</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    ols.fit(A, b)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    Rsquare <span class="op">=</span> met.r2_score(ols.predict(A), b)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"R^2: </span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(Rsquare))</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    ols_results <span class="op">=</span> pd.DataFrame(</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>[ols.coef_],</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>        columns<span class="op">=</span>term_matrix.columns,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>        index<span class="op">=</span>[<span class="st">"Coefficients"</span>]</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ols_results</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>compute_ols_results(term_matrix, h_t)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R^2: 0.9996492734907563</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">h(x, t)</th>
<th data-quarto-table-cell-role="th">h_x(x, t)</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h(x, t)**2</th>
<th data-quarto-table-cell-role="th">h(x, t)*h_x(x, t)</th>
<th data-quarto-table-cell-role="th">h(x, t)*h_xx(x, t)</th>
<th data-quarto-table-cell-role="th">h(x, t)*h_xxx(x, t)</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)**2*h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxx(x, t)**3</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxx(x, t)**2*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxx(x, t)*h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxxx(x, t)**3</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)**4</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)**3*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)**2*h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)*h_xxxx(x, t)**3</th>
<th data-quarto-table-cell-role="th">h_xxxx(x, t)**4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Coefficients</td>
<td>-0.006074</td>
<td>-0.000767</td>
<td>0.012011</td>
<td>-0.019441</td>
<td>0.020865</td>
<td>-0.001556</td>
<td>0.001374</td>
<td>-0.001566</td>
<td>-0.003335</td>
<td>-0.005921</td>
<td>...</td>
<td>-6.012885e-10</td>
<td>1.292627e-09</td>
<td>-3.423755e-11</td>
<td>1.410440e-11</td>
<td>-2.050787e-12</td>
<td>1.208457e-10</td>
<td>-2.007819e-12</td>
<td>8.242712e-14</td>
<td>1.095998e-14</td>
<td>-1.987343e-15</td>
</tr>
</tbody>
</table>

<p>1 rows × 126 columns</p>
</div>
</div>
</div>
<p>Although the <span class="math inline">\(R^2\)</span> value implies that we have successful explained the variance in <span class="math inline">\(h_t\)</span> by linearly combining our term library, it is unclear which of all the terms most contributes to the time evolution from their coefficients.</p>
</section>
<section id="lasso" class="level4">
<h4 class="anchored" data-anchor-id="lasso">Lasso</h4>
<p>Now, let’s add some regularization to try to remove some terms with the Lasso regression:</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_lasso_results(A,b,lamb):</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    lasso <span class="op">=</span> lm.Lasso(lamb)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    lasso.fit(A,b)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    lasso_results <span class="op">=</span> pd.DataFrame(</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>[lasso.coef_[lasso.coef_ <span class="op">!=</span> <span class="dv">0</span>]],</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>        columns<span class="op">=</span>term_matrix.columns[lasso.coef_ <span class="op">!=</span> <span class="dv">0</span>],</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>        index<span class="op">=</span>[<span class="st">"Coefficients"</span>]</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> lasso_results</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>compute_lasso_results(term_matrix,h_t,<span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/connor/mambaforge/envs/website/lib/python3.9/site-packages/sklearn/linear_model/_coordinate_descent.py:648: ConvergenceWarning: Objective did not converge. You might want to increase the number of iterations, check the scale of the features or consider increasing regularisation. Duality gap: 1.776e+03, tolerance: 1.101e+01
  model = cd_fast.enet_coordinate_descent(</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">h_x(x, t)*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h(x, t)*h_x(x, t)*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h(x, t)*h_xx(x, t)*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h(x, t)*h_xxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h(x, t)*h_xxx(x, t)*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)**2*h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxx(x, t)**3</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxx(x, t)**2*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxx(x, t)*h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxxx(x, t)**3</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)**4</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)**3*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)**2*h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)*h_xxxx(x, t)**3</th>
<th data-quarto-table-cell-role="th">h_xxxx(x, t)**4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Coefficients</td>
<td>-0.000042</td>
<td>0.000011</td>
<td>0.000006</td>
<td>-0.000013</td>
<td>0.000006</td>
<td>-9.324149e-08</td>
<td>0.000018</td>
<td>-0.00001</td>
<td>-0.000006</td>
<td>-0.000003</td>
<td>...</td>
<td>3.263501e-12</td>
<td>4.454580e-10</td>
<td>-3.401866e-10</td>
<td>7.938618e-12</td>
<td>-2.294608e-13</td>
<td>-1.175425e-11</td>
<td>1.186419e-11</td>
<td>-5.447040e-13</td>
<td>3.270449e-14</td>
<td>-2.627133e-16</td>
</tr>
</tbody>
</table>

<p>1 rows × 85 columns</p>
</div>
</div>
</div>
<p>Now this at least removed some of the terms, but it also removed the term we know is correct! It’s somewhat hard to interpret exactly what this means. A convenient analysis using the Lasso method is to perform a “lasso path” in which we steadily decrease the regularization <span class="math inline">\(\lambda\)</span> to add more and more terms and pay attention to the order with which they are added:</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_lasso_path_results(A,b):</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    lambs, coef_path, _ <span class="op">=</span> lm.lasso_path(A, b, alphas<span class="op">=</span>[<span class="dv">1000</span>,<span class="dv">200</span>,<span class="dv">100</span>,<span class="dv">10</span>,<span class="dv">2</span>])</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(coef_path.shape[<span class="dv">1</span>]):</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"lambda = </span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(lambs[i]))</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>        temp_results <span class="op">=</span> pd.DataFrame(</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>            data<span class="op">=</span>[coef_path[:,i][coef_path[:,i] <span class="op">!=</span> <span class="dv">0</span>]],</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>            columns<span class="op">=</span>term_matrix.columns[coef_path[:,i] <span class="op">!=</span> <span class="dv">0</span>],</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>            index<span class="op">=</span>[<span class="st">"Coefficients"</span>]</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>        display(temp_results)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>compute_lasso_path_results(term_matrix,h_t)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>lambda = 1000
lambda = 200
lambda = 100
lambda = 10
lambda = 2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/connor/mambaforge/envs/website/lib/python3.9/site-packages/sklearn/linear_model/_coordinate_descent.py:634: ConvergenceWarning: Objective did not converge. You might want to increase the number of iterations. Duality gap: 6980.483780579942, tolerance: 11.006989386931043
  model = cd_fast.enet_coordinate_descent_gram(
/home/connor/mambaforge/envs/website/lib/python3.9/site-packages/sklearn/linear_model/_coordinate_descent.py:634: ConvergenceWarning: Objective did not converge. You might want to increase the number of iterations. Duality gap: 4524.135133175237, tolerance: 11.006989386931043
  model = cd_fast.enet_coordinate_descent_gram(
/home/connor/mambaforge/envs/website/lib/python3.9/site-packages/sklearn/linear_model/_coordinate_descent.py:634: ConvergenceWarning: Objective did not converge. You might want to increase the number of iterations. Duality gap: 3107.4025479351976, tolerance: 11.006989386931043
  model = cd_fast.enet_coordinate_descent_gram(
/home/connor/mambaforge/envs/website/lib/python3.9/site-packages/sklearn/linear_model/_coordinate_descent.py:634: ConvergenceWarning: Objective did not converge. You might want to increase the number of iterations. Duality gap: 1188.0183171689562, tolerance: 11.006989386931043
  model = cd_fast.enet_coordinate_descent_gram(
/home/connor/mambaforge/envs/website/lib/python3.9/site-packages/sklearn/linear_model/_coordinate_descent.py:634: ConvergenceWarning: Objective did not converge. You might want to increase the number of iterations. Duality gap: 697.3581390562916, tolerance: 11.006989386931043
  model = cd_fast.enet_coordinate_descent_gram(</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h(x, t)*h_xx(x, t)*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h(x, t)*h_xxx(x, t)*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h(x, t)*h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_x(x, t)**2*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_x(x, t)*h_xx(x, t)*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_x(x, t)*h_xxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_x(x, t)*h_xxx(x, t)*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_x(x, t)*h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)**2*h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxx(x, t)**3</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxx(x, t)**2*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxx(x, t)*h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxxx(x, t)**3</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)**4</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)**3*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)**2*h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)*h_xxxx(x, t)**3</th>
<th data-quarto-table-cell-role="th">h_xxxx(x, t)**4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Coefficients</td>
<td>0.000009</td>
<td>-1.087579e-07</td>
<td>-0.000001</td>
<td>-0.000005</td>
<td>2.171248e-07</td>
<td>-0.000024</td>
<td>-0.000019</td>
<td>0.000018</td>
<td>-2.755649e-07</td>
<td>3.451722e-08</td>
<td>...</td>
<td>-8.895495e-11</td>
<td>6.462359e-09</td>
<td>-6.202690e-10</td>
<td>-1.216947e-11</td>
<td>-6.853476e-13</td>
<td>-1.306299e-10</td>
<td>3.176435e-11</td>
<td>-1.961896e-12</td>
<td>3.128785e-14</td>
<td>-1.361317e-16</td>
</tr>
</tbody>
</table>

<p>1 rows × 65 columns</p>
</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h(x, t)*h_xxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h(x, t)*h_xxx(x, t)*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h(x, t)*h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_x(x, t)**2*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_x(x, t)*h_xx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_x(x, t)*h_xx(x, t)*h_xxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_x(x, t)*h_xx(x, t)*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_x(x, t)*h_xxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)**2*h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxx(x, t)**3</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxx(x, t)**2*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxx(x, t)*h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxxx(x, t)**3</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)**4</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)**3*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)**2*h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)*h_xxxx(x, t)**3</th>
<th data-quarto-table-cell-role="th">h_xxxx(x, t)**4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Coefficients</td>
<td>0.000011</td>
<td>-1.387047e-07</td>
<td>-0.000025</td>
<td>-0.000006</td>
<td>2.198013e-07</td>
<td>-0.000021</td>
<td>0.000665</td>
<td>0.000017</td>
<td>-0.000011</td>
<td>0.000016</td>
<td>...</td>
<td>-1.070690e-10</td>
<td>7.987405e-09</td>
<td>-6.214230e-10</td>
<td>-1.383315e-11</td>
<td>-9.970465e-13</td>
<td>-7.850788e-11</td>
<td>4.038726e-11</td>
<td>-1.214295e-12</td>
<td>2.695820e-14</td>
<td>-1.176027e-15</td>
</tr>
</tbody>
</table>

<p>1 rows × 73 columns</p>
</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h(x, t)*h_xxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h(x, t)*h_xxx(x, t)*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h(x, t)*h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_x(x, t)**2*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_x(x, t)*h_xx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_x(x, t)*h_xx(x, t)*h_xxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_x(x, t)*h_xx(x, t)*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_x(x, t)*h_xxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)**2*h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxx(x, t)**3</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxx(x, t)**2*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxx(x, t)*h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxxx(x, t)**3</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)**4</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)**3*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)**2*h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)*h_xxxx(x, t)**3</th>
<th data-quarto-table-cell-role="th">h_xxxx(x, t)**4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Coefficients</td>
<td>0.000013</td>
<td>-2.292844e-07</td>
<td>-0.000043</td>
<td>-0.000005</td>
<td>2.366792e-07</td>
<td>-0.000014</td>
<td>0.001129</td>
<td>0.000014</td>
<td>-0.000006</td>
<td>0.000011</td>
<td>...</td>
<td>-1.032142e-10</td>
<td>8.410341e-09</td>
<td>-6.058633e-10</td>
<td>-1.360524e-11</td>
<td>-1.086436e-12</td>
<td>-3.424014e-11</td>
<td>4.570394e-11</td>
<td>-6.688498e-13</td>
<td>2.538924e-14</td>
<td>-1.630228e-15</td>
</tr>
</tbody>
</table>

<p>1 rows × 73 columns</p>
</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">h_x(x, t)*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h(x, t)*h_x(x, t)*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h(x, t)*h_xx(x, t)*h_xxx(x, t)</th>
<th data-quarto-table-cell-role="th">h(x, t)*h_xx(x, t)*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h(x, t)*h_xxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h(x, t)*h_xxx(x, t)*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)**2*h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxx(x, t)**3</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxx(x, t)**2*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxx(x, t)*h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxxx(x, t)**3</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)**4</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)**3*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)**2*h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)*h_xxxx(x, t)**3</th>
<th data-quarto-table-cell-role="th">h_xxxx(x, t)**4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Coefficients</td>
<td>-0.000067</td>
<td>0.000025</td>
<td>-0.000013</td>
<td>0.000012</td>
<td>-1.936250e-07</td>
<td>-0.000017</td>
<td>-0.000174</td>
<td>0.000006</td>
<td>-0.000052</td>
<td>-0.000005</td>
<td>...</td>
<td>-1.046131e-10</td>
<td>7.854440e-09</td>
<td>-5.748668e-10</td>
<td>-1.008073e-11</td>
<td>-1.033930e-12</td>
<td>-1.095605e-11</td>
<td>4.469762e-11</td>
<td>-1.600585e-13</td>
<td>2.423573e-14</td>
<td>-1.629860e-15</td>
</tr>
</tbody>
</table>

<p>1 rows × 88 columns</p>
</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">h_x(x, t)*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h(x, t)**2*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h(x, t)*h_x(x, t)*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h(x, t)*h_xx(x, t)*h_xxx(x, t)</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)**2*h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxx(x, t)**3</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxx(x, t)**2*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxx(x, t)*h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)*h_xxxx(x, t)**3</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)**4</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)**3*h_xxxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)**2*h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)*h_xxxx(x, t)**3</th>
<th data-quarto-table-cell-role="th">h_xxxx(x, t)**4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Coefficients</td>
<td>-0.00013</td>
<td>-0.000047</td>
<td>0.000031</td>
<td>0.000036</td>
<td>-0.00001</td>
<td>0.00001</td>
<td>-1.567570e-07</td>
<td>-0.000049</td>
<td>-0.000029</td>
<td>-0.00042</td>
<td>...</td>
<td>-1.108456e-10</td>
<td>6.983191e-09</td>
<td>-4.148959e-10</td>
<td>-1.275555e-11</td>
<td>-8.681877e-13</td>
<td>-4.061798e-12</td>
<td>3.953281e-11</td>
<td>3.713025e-13</td>
<td>1.342052e-14</td>
<td>-1.264346e-15</td>
</tr>
</tbody>
</table>

<p>1 rows × 95 columns</p>
</div>
</div>
</div>
<p>Again, although this gives us a sense of sparsity, it also doesn’t seem to capture the solution well.</p>
</section>
<section id="greedy-forward-selection" class="level4">
<h4 class="anchored" data-anchor-id="greedy-forward-selection">Greedy forward selection</h4>
<p>Let’s instead try a greedy method for our system that will inform which terms should be included. To do so, we will use a generic <code>scikit-learn</code> interface called <code>SequentialFeatureSelector</code> as well as the <span class="math inline">\(R^2\)</span> coefficient of determination <code>r2_score</code> to select terms one by one that best “explain the variance” in the time evolution <span class="math inline">\(h_t(x,t)\)</span>. As the terms are selected, we will compute the coefficients of the small libraries via ordinary least squares:</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sklearn.feature_selection <span class="im">as</span> fs</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> forward_r2_select(A,b,num_terms<span class="op">=</span><span class="dv">4</span>):</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,num_terms<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>        sfs <span class="op">=</span> fs.SequentialFeatureSelector(</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>            lm.LinearRegression(),</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>            n_features_to_select<span class="op">=</span>i,</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>            scoring<span class="op">=</span>met.make_scorer(met.r2_score)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>        new_A <span class="op">=</span> sfs.fit_transform(A,b)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>        new_ols <span class="op">=</span> sfs.estimator</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>        new_ols.fit(new_A,b)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>        Rsquare <span class="op">=</span> met.r2_score(new_ols.predict(new_A),b)</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>        feat_names <span class="op">=</span> sfs.get_feature_names_out(A.columns)</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"R^2: </span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(Rsquare))</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>        temp_results <span class="op">=</span> pd.DataFrame(</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>            data<span class="op">=</span>[new_ols.coef_],</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>            columns<span class="op">=</span>feat_names,</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>            index<span class="op">=</span>[<span class="st">"Coefficients"</span>]</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>        display(temp_results)</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>forward_r2_select(term_matrix, h_t)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R^2: 0.9998860862791236
R^2: 0.999894405563566
R^2: 0.9998959178372478
R^2: 0.999896315291591</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">h_x(x, t)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Coefficients</td>
<td>0.994806</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">h_x(x, t)</th>
<th data-quarto-table-cell-role="th">h(x, t)*h_x(x, t)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Coefficients</td>
<td>0.999196</td>
<td>-0.003702</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">h_x(x, t)</th>
<th data-quarto-table-cell-role="th">h(x, t)*h_x(x, t)</th>
<th data-quarto-table-cell-role="th">h_x(x, t)**2*h_xxx(x, t)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Coefficients</td>
<td>0.999783</td>
<td>-0.002925</td>
<td>9.549915e-07</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">h_x(x, t)</th>
<th data-quarto-table-cell-role="th">h(x, t)*h_x(x, t)</th>
<th data-quarto-table-cell-role="th">h_x(x, t)**2*h_xxx(x, t)</th>
<th data-quarto-table-cell-role="th">h_xxxx(x, t)**3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Coefficients</td>
<td>0.999799</td>
<td>-0.002916</td>
<td>9.808213e-07</td>
<td>2.122813e-14</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>This seems to easily pick up that the only term needed to completely resolve the time evolution is <span class="math inline">\(h_x(x,t)\)</span>!</p>
</section>
</section>
</section>
<section id="sec-noisy" class="level2">
<h2 class="anchored" data-anchor-id="sec-noisy">Application to noisy simulated wave data</h2>
<p>In a real system, we could not expect to immediately have data as smooth as that we used in <a href="#sec-simulated" class="quarto-xref">Section&nbsp;3</a>. However, the procedure is unchanged. The only challenge will be fitting the neural network to our data. Let’s add some noise to the data:</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>x,t,noisy_h <span class="op">=</span> load_data(<span class="st">"simple_wave.npz"</span>,<span class="fl">.2</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>animation2 <span class="op">=</span> animate_data(x,t,[noisy_h], [<span class="st">"h noisy"</span>])</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>animation2.save(<span class="st">"noisy_h.gif"</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>plt.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="noisy_h.gif" class="img-fluid"></p>
<p>Given our data is now noisy, we may want to implement a train-validation-test method for fitting. Simply put, this means that we will hold out a portion of our data from the training procedure. Part of this held-back data (validation set) will be used to validate that our model can generalize to other points during training. The other part of the held-back data (test set) will be used as a final check on how well the model extrapolates out of the training data.</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sklearn.model_selection <span class="im">as</span> ms</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>X,T <span class="op">=</span> jnp.meshgrid(x,t)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>xt_noisy <span class="op">=</span> np.vstack((X.flatten(),T.flatten())).T</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>h_noisy <span class="op">=</span> noisy_h.flatten()</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>xt_train, xt_test, h_train, h_test <span class="op">=</span> ms.train_test_split(xt_noisy,h_noisy,test_size<span class="op">=</span><span class="fl">.1</span>,train_size<span class="op">=</span><span class="fl">.9</span>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>xt_train, xt_valid, h_train, h_valid <span class="op">=</span> ms.train_test_split(xt_train,h_train,test_size<span class="op">=</span><span class="fl">.1</span>,train_size<span class="op">=</span><span class="fl">.9</span>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>train_data <span class="op">=</span> batch_data(xt_train[:,<span class="dv">0</span>], xt_train[:,<span class="dv">1</span>], h_train, <span class="dv">1000</span>)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>valid_data <span class="op">=</span> batch_data(xt_valid[:,<span class="dv">0</span>], xt_valid[:,<span class="dv">1</span>], h_valid, <span class="dv">1000</span>)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>test_data <span class="op">=</span> batch_data(xt_test[:,<span class="dv">0</span>], xt_test[:,<span class="dv">1</span>], h_test, <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, we apply our previous model construction and training:</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize model</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>rng1,rng2 <span class="op">=</span> jax.random.split(jax.random.PRNGKey(<span class="dv">42</span>))</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>random_data <span class="op">=</span> jax.random.normal(rng1,(<span class="dv">2</span>,))</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>model2 <span class="op">=</span> MyNet()</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>params2 <span class="op">=</span> model2.init(rng2,random_data)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Loss function</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="at">@jax.jit</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mse(params,<span class="bu">input</span>,targets):</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> squared_error(x,y):</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>        pred <span class="op">=</span> model2.<span class="bu">apply</span>(params,x)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jnp.mean((y <span class="op">-</span> pred)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> jnp.mean(jax.vmap(squared_error)(<span class="bu">input</span>,targets),axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>loss_grad_fn <span class="op">=</span> jax.value_and_grad(mse)</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimizer</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>learning_rate <span class="op">=</span> <span class="fl">1e-2</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>tx <span class="op">=</span> optax.adam(learning_rate)</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>opt_state <span class="op">=</span> tx.init(params2)</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Training (adjusted to use our validation data</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>epochs <span class="op">=</span> <span class="dv">1200</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(epochs):</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>    xt_batch <span class="op">=</span> train_data[i<span class="op">%</span><span class="bu">len</span>(train_data)][<span class="dv">0</span>]</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>    h_batch <span class="op">=</span> train_data[i<span class="op">%</span><span class="bu">len</span>(train_data)][<span class="dv">1</span>]</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>    loss_val, grads <span class="op">=</span> loss_grad_fn(params2, xt_batch, h_batch)</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>    updates, opt_state <span class="op">=</span> tx.update(grads, opt_state)</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>    params2 <span class="op">=</span> optax.apply_updates(params2, updates)</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">%</span> <span class="dv">100</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>        train_loss <span class="op">=</span> mse(params2,xt_train,h_train)</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>        valid_loss <span class="op">=</span> mse(params2,xt_valid,h_valid)</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Step </span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(i))</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Training loss: </span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(train_loss))</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Validation loss: </span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(valid_loss))</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>()</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>test_loss <span class="op">=</span> mse(params2,xt_test,h_test)</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test loss after training: </span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(test_loss))</span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>hhat2 <span class="op">=</span> model2.<span class="bu">apply</span>(params2,xt_points).reshape(X.shape)</span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>diff <span class="op">=</span> np.sqrt((noisy_h <span class="op">-</span> hhat2)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a>diff2 <span class="op">=</span> np.sqrt((hhat1 <span class="op">-</span> hhat2)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a>animation3 <span class="op">=</span> animate_data(x,t,[noisy_h,hhat2,diff],[<span class="st">"$h$"</span>,<span class="st">"$\hat</span><span class="sc">{h}</span><span class="st">$"</span>,<span class="st">"$L^2$ error"</span>])</span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>animation3.save(<span class="st">"noisy_h_compare.gif"</span>)</span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a>plt.close()</span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a>animation3 <span class="op">=</span> animate_data(x,t,[hhat1,hhat2,diff2],[<span class="st">"$\hat</span><span class="sc">{h}</span><span class="st">$ clean"</span>,<span class="st">"$\hat</span><span class="sc">{h}</span><span class="st">$ noisy"</span>,<span class="st">"$L^2$ error"</span>])</span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a>animation3.save(<span class="st">"noisy_hhat_compare.gif"</span>)</span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a>plt.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Step 0
Training loss: 1.0839306116104126
Validation loss: 1.1880024671554565

Step 100
Training loss: 0.2529764771461487
Validation loss: 0.28380659222602844

Step 200
Training loss: 0.16499020159244537
Validation loss: 0.17510230839252472

Step 300
Training loss: 0.13047386705875397
Validation loss: 0.12965114414691925

Step 400
Training loss: 0.07818066328763962
Validation loss: 0.07242970168590546

Step 500
Training loss: 0.04669160768389702
Validation loss: 0.04420790821313858

Step 600
Training loss: 0.04208264872431755
Validation loss: 0.04083852097392082

Step 700
Training loss: 0.039955753833055496
Validation loss: 0.039250146597623825

Step 800
Training loss: 0.03985001891851425
Validation loss: 0.03994066268205643

Step 900
Training loss: 0.04050833359360695
Validation loss: 0.04085934907197952

Step 1000
Training loss: 0.040248990058898926
Validation loss: 0.040409237146377563

Step 1100
Training loss: 0.0393543541431427
Validation loss: 0.03912331536412239

Test loss after training: 0.039526768028736115</code></pre>
</div>
</div>
<p>The resulting fit can be seen in the following video:</p>
<p><img src="noisy_h_compare.gif" class="img-fluid"></p>
<p>Looks pretty good all things considered! We can also compare this with the fit on clean data to see how impressive the robustness to noise was:</p>
<p><img src="noisy_hhat_compare.gif" class="img-fluid"></p>
<p>Finally, we construct the terms and check the results after forward selection:</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> model_for_diff(x,t):</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    new_x <span class="op">=</span> jnp.array([x,t])</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model2.<span class="bu">apply</span>(params2, new_x)[<span class="dv">0</span>]</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Construct terms numerically</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>diff_term_values <span class="op">=</span> {}</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(max_diff_order<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    diff_func <span class="op">=</span> model_for_diff</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Iteratively apply derivatives</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(i):</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>        diff_func <span class="op">=</span> jax.grad(diff_func, <span class="dv">0</span>)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> unpack_diff_func(x):</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>        new_x,new_t <span class="op">=</span> x</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> diff_func(new_x,new_t)</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>    diff_term_values[diff_terms[i]] <span class="op">=</span> np.array(jax.lax.<span class="bu">map</span>(unpack_diff_func, xt_points))</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>term_values <span class="op">=</span> construct_terms(diff_term_values)</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> unpack_diff_func(x):</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>    new_x,new_t <span class="op">=</span> x</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> jax.grad(model_for_diff,<span class="dv">1</span>)(new_x,new_t)</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>h_t_term <span class="op">=</span> sp.Function(<span class="st">"h_t"</span>)(x_sym,t_sym)</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>h_t <span class="op">=</span> <span class="op">-</span>np.array(jax.lax.<span class="bu">map</span>(unpack_diff_func, xt_points))</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Forward selection</span></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>term_matrix <span class="op">=</span> pd.DataFrame(term_values,index<span class="op">=</span>pd.MultiIndex.from_arrays(np.<span class="bu">round</span>(np.array(xt_points),<span class="dv">2</span>).T, names<span class="op">=</span>(<span class="st">"x"</span>,<span class="st">"t"</span>)))</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>forward_r2_select(term_matrix, h_t)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R^2: 0.9992922625224863
R^2: 0.9993020536736786
R^2: 0.999314004266004
R^2: 0.9993156257451148</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">h_x(x, t)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Coefficients</td>
<td>0.999435</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">h_x(x, t)</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)**2*h_xxxx(x, t)**2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Coefficients</td>
<td>0.999985</td>
<td>-1.378831e-14</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">h_x(x, t)</th>
<th data-quarto-table-cell-role="th">h_x(x, t)**3</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)**2*h_xxxx(x, t)**2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Coefficients</td>
<td>1.008283</td>
<td>-0.000179</td>
<td>-1.257324e-14</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">h_x(x, t)</th>
<th data-quarto-table-cell-role="th">h_x(x, t)**3</th>
<th data-quarto-table-cell-role="th">h_xx(x, t)**2*h_xxxx(x, t)**2</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)**2*h_xxxx(x, t)**2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Coefficients</td>
<td>1.009172</td>
<td>-0.000195</td>
<td>-2.579226e-13</td>
<td>-9.285486e-15</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Boom! Landed right on the money. This is a simple example with a straightforward answer, but example holds to show the overall procedure for handling data with additive noise (multiplicative noise, which is more structural, would be an altogether different challenge).</p>
</section>
<section id="sec-extracted" class="level2">
<h2 class="anchored" data-anchor-id="sec-extracted">Application to extracted wave data</h2>
<p>Now, applying this procedure to real data is as simple as replacing our original dataset with an experimental dataset. However, the extraction process has a strong influence on the quality of the data that we will be using, so it deserves to be treated with some detail.</p>
<section id="image-data-extraction" class="level3">
<h3 class="anchored" data-anchor-id="image-data-extraction">Image data extraction</h3>
<p>The original video we will be using can be found on YouTube <a href="https://www.youtube.com/watch?v=wEbYELtGZwI">here</a>.</p>
<p><video src="youtube_video.mp4" class="img-fluid" controls=""><a href="youtube_video.mp4">Video</a></video></p>
<p>We can load this video into individual image frames via:</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> skimage <span class="im">as</span> img</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> imageio.v3 <span class="im">as</span> iio</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>raw_frames <span class="op">=</span> []</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>cut <span class="op">=</span> (<span class="dv">160</span>,<span class="dv">200</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">200</span>,<span class="dv">232</span>):</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    frame <span class="op">=</span> iio.imread(<span class="st">"youtube_video.mp4"</span>,plugin<span class="op">=</span><span class="st">"pyav"</span>,index<span class="op">=</span>i)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cut the image to focus only on the wave portion</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    raw_frame <span class="op">=</span> frame[cut[<span class="dv">0</span>]:cut[<span class="dv">1</span>],:,:]</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    raw_frames.append(raw_frame)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>raw_frames <span class="op">=</span> np.array(raw_frames)</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">1</span>))</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>plt.imshow(raw_frames[<span class="dv">16</span>])</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="va">False</span>)<span class="op">;</span> plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="workshop3_discovery_files/figure-html/cell-26-output-1.png" width="614" height="72" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We then need to remove the background and isolate the wave portion of the image, which is facilitated by the green color of the water in this video:</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>frames <span class="op">=</span> []</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(raw_frames)):</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    frame <span class="op">=</span> raw_frames[i]</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find where the image is more green than red or blue and very bright green</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    mean_green <span class="op">=</span> np.mean(frame[:,:,<span class="dv">1</span>])</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    std_green <span class="op">=</span> np.std(frame[:,:,<span class="dv">1</span>])</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    frame <span class="op">=</span> (frame[:,:,<span class="dv">1</span>] <span class="op">&gt;</span> frame[:,:,<span class="dv">0</span>]) <span class="op">&amp;</span> (frame[:,:,<span class="dv">1</span>] <span class="op">&gt;</span> frame[:,:,<span class="dv">2</span>]) <span class="op">&amp;</span> (frame[:,:,<span class="dv">1</span>] <span class="op">&gt;</span> mean_green<span class="op">+</span>std_green)</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    frames.append(frame)</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>frames <span class="op">=</span> np.array(frames)</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">1</span>))</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>plt.imshow(frames[<span class="dv">16</span>],cmap<span class="op">=</span><span class="st">"gray"</span>)</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="va">False</span>)<span class="op">;</span> plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="workshop3_discovery_files/figure-html/cell-27-output-1.png" width="614" height="72" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>By averaging these pixels across all vertical pixels in the image, we can get a rough wave outline:</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>heights <span class="op">=</span> []</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(frames)):</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    frame <span class="op">=</span> frames[i]</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Approximate wave height by averaging y-locations of bright green areas</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    height <span class="op">=</span> np.zeros(frame.shape[<span class="dv">1</span>])</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(frame.shape[<span class="dv">1</span>]):</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>        height[j] <span class="op">=</span> np.mean(np.where(frame[:,j] <span class="op">==</span> <span class="dv">1</span>)[<span class="dv">0</span>])</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    heights.append(height)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>heights <span class="op">=</span> np.array(heights)</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>base <span class="op">=</span> heights[<span class="dv">16</span>, <span class="dv">0</span>]</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">1</span>))</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>plt.imshow(frames[<span class="dv">16</span>],cmap<span class="op">=</span><span class="st">"gray"</span>)</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>line <span class="op">=</span> plt.plot(heights[<span class="dv">16</span>], color<span class="op">=</span><span class="st">"red"</span>,lw<span class="op">=</span><span class="dv">3</span>)[<span class="dv">0</span>]</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>line2 <span class="op">=</span> plt.plot([<span class="dv">0</span>,heights.shape[<span class="dv">1</span>]], [<span class="dv">31</span>,<span class="dv">31</span>], color<span class="op">=</span><span class="st">"orange"</span>, ls<span class="op">=</span><span class="st">"--"</span>)[<span class="dv">0</span>]</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="va">False</span>)<span class="op">;</span> plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="workshop3_discovery_files/figure-html/cell-28-output-1.png" width="614" height="70" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Finally, we can note that the video is not quite level to the wave surface, so we can use a linear adjustment to align the water boundary heights at the middle of the video:</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust images and heights for an un-leveled camera</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>im_width <span class="op">=</span> <span class="bu">len</span>(heights[<span class="dv">16</span>])</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>slope <span class="op">=</span> (heights[<span class="dv">16</span>][<span class="op">-</span><span class="dv">1</span>] <span class="op">-</span> heights[<span class="dv">16</span>][<span class="dv">0</span>]) <span class="op">/</span> im_width</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(heights)):</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    frame <span class="op">=</span> frames[i]</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    height <span class="op">=</span> heights[i]</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Adjust</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(height)):</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>        shift <span class="op">=</span> <span class="bu">int</span>(slope<span class="op">*</span>(im_width<span class="op">-</span>j))</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Move frame pixels per column</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>        frame[:,j] <span class="op">=</span> np.roll(frame[:,j], shift)</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Move height of wave</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>        height[j] <span class="op">+=</span> shift</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>    frames[i] <span class="op">=</span> frame</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>    heights[i] <span class="op">=</span> height</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>frames <span class="op">=</span> np.array(frames)</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>raw_frames <span class="op">=</span> np.array(raw_frames)</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>heights <span class="op">=</span> np.array(heights)</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">1</span>))</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>im <span class="op">=</span> plt.imshow(frames[<span class="dv">0</span>],cmap<span class="op">=</span><span class="st">"gray"</span>)</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>line <span class="op">=</span> plt.plot(heights[<span class="dv">0</span>], color<span class="op">=</span><span class="st">"red"</span>,lw<span class="op">=</span><span class="dv">3</span>)[<span class="dv">0</span>]</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>line2 <span class="op">=</span> plt.plot([<span class="dv">0</span>,heights.shape[<span class="dv">1</span>]], [<span class="dv">31</span>,<span class="dv">31</span>], color<span class="op">=</span><span class="st">"orange"</span>, ls<span class="op">=</span><span class="st">"--"</span>)[<span class="dv">0</span>]</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="va">False</span>)<span class="op">;</span></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> animation_function(i):</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>    im.set_array(frames[i])</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>    line.set_ydata(heights[i])</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [im,line,line2]</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>wave_animation <span class="op">=</span> anim.FuncAnimation(fig, animation_function, frames<span class="op">=</span><span class="bu">range</span>(<span class="bu">len</span>(frames)), blit<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>wave_animation.save(<span class="st">"extracted_wave.gif"</span>)</span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>plt.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="extracted_wave.gif" class="img-fluid"></p>
<p>We can now save this data to be used with our previous procedure:</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Video portion is about 2 seconds long</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>times <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="dv">2</span>,<span class="bu">len</span>(heights))</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># No given space scale</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>x_domain <span class="op">=</span> np.arange(<span class="bu">len</span>(heights[<span class="dv">0</span>]))</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>np.save(<span class="st">"video_wave_images.npy"</span>,raw_frames)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>np.savez(<span class="st">"video_wave_heights.npz"</span>,h<span class="op">=</span>heights,x<span class="op">=</span>x_domain,t<span class="op">=</span>times)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="using-our-experimental-dataset" class="level3">
<h3 class="anchored" data-anchor-id="using-our-experimental-dataset">Using our experimental dataset</h3>
<p>Using the same methods as listed in <a href="#sec-noisy" class="quarto-xref">Section&nbsp;4</a>, we can discover an equation for this particular dataset:</p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>x,t,ext_h <span class="op">=</span> load_data(<span class="st">"video_wave_heights.npz"</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Flip image wave to be more familiar</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>ext_h <span class="op">=</span> <span class="op">-</span>ext_h</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>animation2 <span class="op">=</span> animate_data(x,t,[ext_h], [<span class="st">"extracted h"</span>])</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>animation2.save(<span class="st">"extracted_h.gif"</span>)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>plt.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="extracted_h.gif" class="img-fluid"></p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Splitting data</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>X,T <span class="op">=</span> jnp.meshgrid(x,t)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>xt_ext <span class="op">=</span> np.vstack((X.flatten(),T.flatten())).T</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>h_ext <span class="op">=</span> ext_h.flatten()</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>xt_train, xt_test, h_train, h_test <span class="op">=</span> ms.train_test_split(xt_ext,h_ext,test_size<span class="op">=</span><span class="fl">.1</span>,train_size<span class="op">=</span><span class="fl">.9</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>xt_train, xt_valid, h_train, h_valid <span class="op">=</span> ms.train_test_split(xt_train,h_train,test_size<span class="op">=</span><span class="fl">.1</span>,train_size<span class="op">=</span><span class="fl">.9</span>)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>train_data <span class="op">=</span> batch_data(xt_train[:,<span class="dv">0</span>], xt_train[:,<span class="dv">1</span>], h_train, <span class="dv">1000</span>)</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>valid_data <span class="op">=</span> batch_data(xt_valid[:,<span class="dv">0</span>], xt_valid[:,<span class="dv">1</span>], h_valid, <span class="dv">1000</span>)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>test_data <span class="op">=</span> batch_data(xt_test[:,<span class="dv">0</span>], xt_test[:,<span class="dv">1</span>], h_test, <span class="dv">1000</span>)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize model</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>rng1,rng2 <span class="op">=</span> jax.random.split(jax.random.PRNGKey(<span class="dv">42</span>))</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>random_data <span class="op">=</span> jax.random.normal(rng1,(<span class="dv">2</span>,))</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>model3 <span class="op">=</span> MyNet()</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>params3 <span class="op">=</span> model3.init(rng2,random_data)</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Loss function</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a><span class="at">@jax.jit</span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mse(params,<span class="bu">input</span>,targets):</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> squared_error(x,y):</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>        pred <span class="op">=</span> model3.<span class="bu">apply</span>(params,x)</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jnp.mean((y <span class="op">-</span> pred)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> jnp.mean(jax.vmap(squared_error)(<span class="bu">input</span>,targets),axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>loss_grad_fn <span class="op">=</span> jax.value_and_grad(mse)</span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimizer</span></span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>learning_rate <span class="op">=</span> <span class="fl">1e-2</span></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>tx <span class="op">=</span> optax.adam(learning_rate)</span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>opt_state <span class="op">=</span> tx.init(params3)</span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Training (adjusted to use our validation data</span></span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a>epochs <span class="op">=</span> <span class="dv">1200</span></span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(epochs):</span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a>    xt_batch <span class="op">=</span> train_data[i<span class="op">%</span><span class="bu">len</span>(train_data)][<span class="dv">0</span>]</span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a>    h_batch <span class="op">=</span> train_data[i<span class="op">%</span><span class="bu">len</span>(train_data)][<span class="dv">1</span>]</span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a>    loss_val, grads <span class="op">=</span> loss_grad_fn(params3, xt_batch, h_batch)</span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a>    updates, opt_state <span class="op">=</span> tx.update(grads, opt_state)</span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a>    params3 <span class="op">=</span> optax.apply_updates(params3, updates)</span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">%</span> <span class="dv">100</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a>        train_loss <span class="op">=</span> mse(params3,xt_train,h_train)</span>
<span id="cb44-42"><a href="#cb44-42" aria-hidden="true" tabindex="-1"></a>        valid_loss <span class="op">=</span> mse(params3,xt_valid,h_valid)</span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Step </span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(i))</span>
<span id="cb44-44"><a href="#cb44-44" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Training loss: </span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(train_loss))</span>
<span id="cb44-45"><a href="#cb44-45" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Validation loss: </span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(valid_loss))</span>
<span id="cb44-46"><a href="#cb44-46" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>()</span>
<span id="cb44-47"><a href="#cb44-47" aria-hidden="true" tabindex="-1"></a>test_loss <span class="op">=</span> mse(params3,xt_test,h_test)</span>
<span id="cb44-48"><a href="#cb44-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test loss after training: </span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(test_loss))</span>
<span id="cb44-49"><a href="#cb44-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-50"><a href="#cb44-50" aria-hidden="true" tabindex="-1"></a>hhat <span class="op">=</span> model3.<span class="bu">apply</span>(params3,xt_ext).reshape(X.shape)</span>
<span id="cb44-51"><a href="#cb44-51" aria-hidden="true" tabindex="-1"></a>diff <span class="op">=</span> np.sqrt((ext_h <span class="op">-</span> hhat)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb44-52"><a href="#cb44-52" aria-hidden="true" tabindex="-1"></a>animation3 <span class="op">=</span> animate_data(x,t,[ext_h,hhat,diff],[<span class="st">"$extracted h$"</span>,<span class="st">"$\hat</span><span class="sc">{h}</span><span class="st">$"</span>,<span class="st">"$L^2$ error"</span>])</span>
<span id="cb44-53"><a href="#cb44-53" aria-hidden="true" tabindex="-1"></a>animation3.save(<span class="st">"ext_h_compare.gif"</span>)</span>
<span id="cb44-54"><a href="#cb44-54" aria-hidden="true" tabindex="-1"></a>plt.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Step 0
Training loss: 1.0430516004562378
Validation loss: 1.0766783952713013

Step 100
Training loss: 0.018125249072909355
Validation loss: 0.01899655908346176

Step 200
Training loss: 0.015589875169098377
Validation loss: 0.016529928892850876

Step 300
Training loss: 0.01496046781539917
Validation loss: 0.01591702178120613

Step 400
Training loss: 0.014640039764344692
Validation loss: 0.015734868124127388

Step 500
Training loss: 0.013847903348505497
Validation loss: 0.015050699934363365

Step 600
Training loss: 0.013422622345387936
Validation loss: 0.0145771699026227

Step 700
Training loss: 0.012840907089412212
Validation loss: 0.014002472162246704

Step 800
Training loss: 0.012728855013847351
Validation loss: 0.01390550285577774

Step 900
Training loss: 0.012514415197074413
Validation loss: 0.013635623268783092

Step 1000
Training loss: 0.011771985329687595
Validation loss: 0.013032175600528717

Step 1100
Training loss: 0.011503455229103565
Validation loss: 0.012660597451031208

Test loss after training: 0.0104597182944417</code></pre>
</div>
</div>
<p><img src="ext_h_compare.gif" class="img-fluid"></p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> model_for_diff(x,t):</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    new_x <span class="op">=</span> jnp.array([x,t])</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model3.<span class="bu">apply</span>(params3, new_x)[<span class="dv">0</span>]</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Construct terms numerically</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>diff_term_values <span class="op">=</span> {}</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(max_diff_order<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    diff_func <span class="op">=</span> model_for_diff</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Iteratively apply derivatives</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(i):</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>        diff_func <span class="op">=</span> jax.grad(diff_func, <span class="dv">0</span>)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> unpack_diff_func(x):</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>        new_x,new_t <span class="op">=</span> x</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> diff_func(new_x,new_t)</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>    diff_term_values[diff_terms[i]] <span class="op">=</span> np.array(jax.lax.<span class="bu">map</span>(unpack_diff_func, xt_ext))</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>term_values <span class="op">=</span> construct_terms(diff_term_values)</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> unpack_diff_func(x):</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>    new_x,new_t <span class="op">=</span> x</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> jax.grad(model_for_diff,<span class="dv">1</span>)(new_x,new_t)</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>h_t_term <span class="op">=</span> sp.Function(<span class="st">"h_t"</span>)(x_sym,t_sym)</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>h_t <span class="op">=</span> <span class="op">-</span>np.array(jax.lax.<span class="bu">map</span>(unpack_diff_func, xt_ext))</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Forward selection</span></span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>term_matrix <span class="op">=</span> pd.DataFrame(term_values,index<span class="op">=</span>pd.MultiIndex.from_arrays(np.<span class="bu">round</span>(np.array(xt_ext),<span class="dv">2</span>).T, names<span class="op">=</span>(<span class="st">"x"</span>,<span class="st">"t"</span>)))</span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>forward_r2_select(term_matrix, h_t)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R^2: 0.9863934214868251
R^2: 0.9865333532703366
R^2: 0.9882344773693393
R^2: 0.991064364883932</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">h_x(x, t)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Coefficients</td>
<td>-0.965739</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">h_x(x, t)</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Coefficients</td>
<td>-0.97502</td>
<td>-0.000325</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">h_x(x, t)</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)</th>
<th data-quarto-table-cell-role="th">h(x, t)*h_xxx(x, t)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Coefficients</td>
<td>-0.967936</td>
<td>-0.003446</td>
<td>0.001618</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">h_x(x, t)</th>
<th data-quarto-table-cell-role="th">h_xxx(x, t)</th>
<th data-quarto-table-cell-role="th">h(x, t)*h_xxx(x, t)</th>
<th data-quarto-table-cell-role="th">h(x, t)**2*h_xxx(x, t)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Coefficients</td>
<td>-0.943376</td>
<td>-0.006432</td>
<td>0.00772</td>
<td>-0.002068</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Feel free to play with the parameters of each step to try to change/improve the results we have seen here.</p>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="appendix" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">Appendix</h2><div class="quarto-appendix-contents">



</div></section><section id="the-benefits-of-jax" class="level3 appendix"><h2 class="anchored quarto-appendix-heading">The benefits of JAX</h2><div class="quarto-appendix-contents">

<p><a href="https://jax.readthedocs.io/en/latest/index.html"><code>jax</code></a> is an automatic differentiation based on the <a href="https://www.tensorflow.org/xla">XLA</a> compiler for Tensorflow. The largest difference between this library and the alternative libraries (like those included in <code>tensorflow</code> main, <code>pytorch</code>, <code>keras</code>, etc.) is that it compiles Python code down to a computational graph structure. Although the majority of excitement around this compiler has surrounded the optimizations that can take place one the graph structure has been identified, it also facilitates taking derivatives of arbitrarry objects. This is because rather than compute gradients along the path (forward mode automatic differentiation) or keeping track of operations as it goes (backward mode automatic differentiation), it has a graph structure to analyze exactly what happens to each value and parameter. At the end of the day, this means it is much easier to compute gradients of exactly what you want.</p>
<p>If <code>jax</code> and <code>flax</code> have appeared too hands-on and complicated after this workshop, consider trying <a href="https://cgarciae.github.io/treex/"><code>treex</code></a> which aims to make using <code>jax</code> for neural networks simple and only need a few lines of code.</p>
</div></section><section id="training-without-normalizing-the-data" class="level3 appendix"><h2 class="anchored quarto-appendix-heading">Training without normalizing the data</h2><div class="quarto-appendix-contents">

<p>In the <a href="#sec-simulated" class="quarto-xref">Section&nbsp;3</a> section, the <code>load_data</code> function performs a normalization of the simulated data from a range of <span class="math inline">\(h(x,t) \in [0,.1]\)</span> where <span class="math inline">\(x \in [0,1]\)</span> and <span class="math inline">\(t \in [0,1]\)</span> to a range of <span class="math inline">\(h(x,t) \in [-1,1]\)</span> with mean <span class="math inline">\(\bar{h}=0\)</span> and standard deviation 1 with <span class="math inline">\(x \in [-1.7,1.7]\)</span> and <span class="math inline">\(t \in [-1.7,1.7]\)</span>. Normalizing data like this is common in machine learning, but it is not always apparent why. Our case can give a strong demonstration as to the benefits of normalizing in this way.</p>
<p>Consider that our neural network uses only the <span class="math inline">\(\tanh\)</span> activation function. For those unfamiliar, this function has the form:</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>tanh_dom <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">100</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>tanh_range <span class="op">=</span> np.tanh(tanh_dom)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>plt.plot(tanh_dom, tanh_range, label<span class="op">=</span><span class="st">"$</span><span class="ch">\\</span><span class="st">tanh(x)$"</span>)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"$x$"</span>)<span class="op">;</span> plt.legend()<span class="op">;</span> plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="workshop3_discovery_files/figure-html/cell-34-output-1.png" width="590" height="429" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Each layer of our neural network is connected via linear transformations of the form <span class="math inline">\(\vec{x}^T\mathbf{W} + \vec{b}\)</span>, thus we should be able to shift the data into the appropriate domain and range for the <span class="math inline">\(\tanh\)</span> function. However, in practice, optimizing our parameters to attain this is hard to find. To demonstrate, consider the training of the neural network on clean simulation data without normalization:</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>x,t,h <span class="op">=</span> load_data(<span class="st">"simple_wave.npz"</span>,norm<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>X,T <span class="op">=</span> jnp.meshgrid(x,t)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> batch_data(X.flatten(),T.flatten(),h.flatten(),<span class="dv">10000</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Random generator seed</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>rng1,rng2 <span class="op">=</span> jax.random.split(jax.random.PRNGKey(<span class="dv">42</span>))</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>random_data <span class="op">=</span> jax.random.normal(rng1,(<span class="dv">2</span>,))</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>model4 <span class="op">=</span> MyNet()</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>params4 <span class="op">=</span> model1.init(rng2,random_data)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="at">@jax.jit</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mse(params,<span class="bu">input</span>,targets):</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> squared_error(x,y):</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>        pred <span class="op">=</span> model4.<span class="bu">apply</span>(params,x)</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jnp.mean((y <span class="op">-</span> pred)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> jnp.mean(jax.vmap(squared_error)(<span class="bu">input</span>,targets),axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>loss_grad_fn <span class="op">=</span> jax.value_and_grad(mse)</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>learning_rate <span class="op">=</span> <span class="fl">1e-2</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>tx <span class="op">=</span> optax.adam(learning_rate)</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>opt_state <span class="op">=</span> tx.init(params4)</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>epochs <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>all_xt <span class="op">=</span> jnp.array([data[i][<span class="dv">0</span>] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data))])</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>all_h <span class="op">=</span> jnp.array([data[i][<span class="dv">1</span>] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data))])</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(epochs):</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>    xt_batch <span class="op">=</span> data[i<span class="op">%</span><span class="bu">len</span>(data)][<span class="dv">0</span>]</span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>    h_batch <span class="op">=</span> data[i<span class="op">%</span><span class="bu">len</span>(data)][<span class="dv">1</span>]</span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>    loss_val, grads <span class="op">=</span> loss_grad_fn(params4, xt_batch, h_batch)</span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>    updates, opt_state <span class="op">=</span> tx.update(grads, opt_state)</span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>    params4 <span class="op">=</span> optax.apply_updates(params4, updates)</span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">%</span> <span class="dv">100</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>        train_loss <span class="op">=</span> mse(params4,all_xt,all_h)</span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Training loss step </span><span class="sc">{}</span><span class="st">: </span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(i,train_loss))</span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a>xt_points <span class="op">=</span> jnp.vstack([X.flatten(),T.flatten()]).T</span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a>hhat4 <span class="op">=</span> model1.<span class="bu">apply</span>(params4,xt_points).reshape(X.shape)</span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a>diff <span class="op">=</span> np.sqrt((h <span class="op">-</span> hhat4)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a>animation4 <span class="op">=</span> animate_data(x,t,[h,hhat4,diff],[<span class="st">"$h$"</span>,<span class="st">"$\hat</span><span class="sc">{h}</span><span class="st">$"</span>,<span class="st">"$L^2$ error"</span>])</span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a>animation4.save(<span class="st">"nonorm_h_compare.gif"</span>)</span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a>plt.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Training loss step 0: 0.3563382923603058
Training loss step 100: 0.0009187606628984213
Training loss step 200: 0.0008465295541100204
Training loss step 300: 0.0007735079852864146
Training loss step 400: 0.0006919147563166916
Training loss step 500: 0.0006207430851645768
Training loss step 600: 0.0005757115432061255
Training loss step 700: 0.0005529409390874207
Training loss step 800: 0.0005375399487093091
Training loss step 900: 0.0005216019926592708</code></pre>
</div>
</div>
<p><img src="nonorm_h_compare.gif" class="img-fluid"></p>
<p>The fit is terrible! We have apparently fallen into a local minimum far from the global minimum we would like to find. This demonstrates two important ideas relating to neural networks (validated by experience):</p>
<ol type="1">
<li>They are fickle and in some cases small changes to data, architecture, and training, can dramatically change results</li>
<li>Any help that can be given to the neural network via knowledge of the system or data can help. In this case, adjusting for the gap between the range of our data and that of the activation function was sufficient.</li>
</ol>



</div></section><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body" data-entry-spacing="0" role="list">
<div id="ref-brunton2016discovering" class="csl-entry" role="listitem">
<div class="csl-left-margin">[1] </div><div class="csl-right-inline">S. L. Brunton, J. L. Proctor, and J. N. Kutz, <em>Discovering Governing Equations from Data by Sparse Identification of Nonlinear Dynamical Systems</em>, Proceedings of the National Academy of Sciences <strong>113</strong>, 3932 (2016).</div>
</div>
<div id="ref-williams2015data" class="csl-entry" role="listitem">
<div class="csl-left-margin">[2] </div><div class="csl-right-inline">M. O. Williams, I. G. Kevrekidis, and C. W. Rowley, <em>A Data–Driven Approximation of the Koopman Operator: Extending Dynamic Mode Decomposition</em>, Journal of Nonlinear Science <strong>25</strong>, 1307 (2015).</div>
</div>
<div id="ref-cleveland1988locally" class="csl-entry" role="listitem">
<div class="csl-left-margin">[3] </div><div class="csl-right-inline">W. S. Cleveland and S. J. Devlin, <em>Locally Weighted Regression: An Approach to Regression Analysis by Local Fitting</em>, Journal of the American Statistical Association <strong>83</strong>, 596 (1988).</div>
</div>
<div id="ref-press1990savitzky" class="csl-entry" role="listitem">
<div class="csl-left-margin">[4] </div><div class="csl-right-inline">W. H. Press and S. A. Teukolsky, <em>Savitzky-Golay Smoothing Filters</em>, Computers in Physics <strong>4</strong>, 669 (1990).</div>
</div>
<div id="ref-zheng2018unified" class="csl-entry" role="listitem">
<div class="csl-left-margin">[5] </div><div class="csl-right-inline">P. Zheng, T. Askham, S. L. Brunton, J. N. Kutz, and A. Y. Aravkin, <em>A Unified Framework for Sparse Relaxed Regularized Regression: SR3</em>, IEEE Access <strong>7</strong>, 1404 (2018).</div>
</div>
<div id="ref-rudy2017data" class="csl-entry" role="listitem">
<div class="csl-left-margin">[6] </div><div class="csl-right-inline">S. H. Rudy, S. L. Brunton, J. L. Proctor, and J. N. Kutz, <em>Data-Driven Discovery of Partial Differential Equations</em>, Science Advances <strong>3</strong>, e1602614 (2017).</div>
</div>
<div id="ref-xu2019dl" class="csl-entry" role="listitem">
<div class="csl-left-margin">[7] </div><div class="csl-right-inline">H. Xu, H. Chang, and D. Zhang, <em>Dl-Pde: Deep-Learning Based Data-Driven Discovery of Partial Differential Equations from Discrete and Noisy Data</em>, arXiv Preprint arXiv:1908.04463 (2019).</div>
</div>
</div></section></div></main> <!-- /main -->
<script type="application/vnd.jupyter.widget-state+json">
{"state":{"0c9f444012b44428ab59d515d5ab2b62":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"0f157f5928a447bca20ca21310222c50":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"122bdf724c2c44ed8ca879b9cec1ff33":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HTMLView","description":"","description_allow_html":false,"layout":"IPY_MODEL_0c9f444012b44428ab59d515d5ab2b62","placeholder":"​","style":"IPY_MODEL_9414800c12b144288f52897080e9150a","tabbable":null,"tooltip":null,"value":"100%"}},"2dd9113033de41459648e8369ede3f82":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_122bdf724c2c44ed8ca879b9cec1ff33","IPY_MODEL_b835baa8826b4ac7862d7e561994e86c","IPY_MODEL_96f0c64520bc46abb42584458729115e"],"layout":"IPY_MODEL_7efdd7d624a3499484bc6b9d66b6028f","tabbable":null,"tooltip":null}},"7a7fb53beb094fea9de8f001b9fed6db":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","background":null,"description_width":"","font_size":null,"text_color":null}},"7efdd7d624a3499484bc6b9d66b6028f":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"9414800c12b144288f52897080e9150a":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","background":null,"description_width":"","font_size":null,"text_color":null}},"96f0c64520bc46abb42584458729115e":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HTMLView","description":"","description_allow_html":false,"layout":"IPY_MODEL_f1e5ada77e744470aa1f6796ce95d6bd","placeholder":"​","style":"IPY_MODEL_7a7fb53beb094fea9de8f001b9fed6db","tabbable":null,"tooltip":null,"value":" 100/100 [00:01&lt;00:00, 104.68it/s]"}},"b835baa8826b4ac7862d7e561994e86c":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"ProgressView","bar_style":"success","description":"","description_allow_html":false,"layout":"IPY_MODEL_c99ddf05cb3644dba127498d48d2dd77","max":100,"min":0,"orientation":"horizontal","style":"IPY_MODEL_0f157f5928a447bca20ca21310222c50","tabbable":null,"tooltip":null,"value":100}},"c99ddf05cb3644dba127498d48d2dd77":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"f1e5ada77e744470aa1f6796ce95d6bd":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}}},"version_major":2,"version_minor":0}
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/connor-robertson-773ba8b1/">
      <i class="bi bi-linkedin" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/cnrrobertson">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Connor Robertson, Copyright 2024</p>
</div>
  </div>
</footer>




</body></html>